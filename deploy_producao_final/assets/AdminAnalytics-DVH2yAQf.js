import{j as e}from"./supabase-vendor-vwXl956e.js";import{r as d}from"./react-vendor-DZvRB87w.js";import{s as K,C as M,e as P,R as J,h as W,D as he,B as X,d as B,a as z,b as O,U as xe}from"./index-Bcg3-yyF.js";import{I as ue}from"./input-DeGpYGBS.js";import{T as pe,a as je,b as Y,c as h,d as ge,e as x}from"./table-Nb046eMn.js";import{S as q,a as Q,b as Z,c as ee,d as y}from"./select-4SbkaADg.js";import{D as fe,a as ye,b as ve,c as H,d as Ne}from"./dropdown-menu-Bwx_JN1Y.js";import{L as we}from"./loader-circle-Czu_fY0g.js";import{C as De}from"./circle-alert-D4s_D1mr.js";import{C as Se}from"./calculator-8bjaGrQN.js";import{T as te}from"./trending-up-DmkegI-s.js";import{D as ae}from"./download-f6EqBvdC.js";import{m as be}from"./proxy-CqlErGxY.js";import{R as se,z as Ce,B as re,X as oe,Y as ne,E as le,F as Me,H as Re,I as Ae}from"./BarChart-C76w6z1u.js";import{B as ie}from"./building-2-DmGE8F65.js";import{S as Te}from"./search-DRTCN9dC.js";import{M as Pe}from"./map-pin-B2OXGcAQ.js";import{E as Be}from"./ellipsis-DEtzPhET.js";import{E as Ee}from"./eye-DruPEwY1.js";import"./ui-vendor-Dea2Gxwc.js";import"./index-v7iOeiPF.js";import"./chevron-down-C_P1G3tD.js";import"./check-DqYQ0lV2.js";import"./chevron-up-BMvOzWH0.js";import"./chevron-right-2u11bsEk.js";import"./circle-YrizIO9s.js";const Le=()=>{const[g,E]=d.useState([]),[v,L]=d.useState(null),[N,I]=d.useState([]),[w,o]=d.useState([]),[R,f]=d.useState(!0),[V,D]=d.useState(null),S=async()=>{try{f(!0),D(null),console.log("üìä Iniciando busca de analytics admin...");let u=[],p=0;try{const{count:t,error:s}=await K.from("roi_analises").select("*",{count:"exact",head:!0});if(!s&&t!==null){if(p=t,console.log(`‚úÖ ${p} an√°lises encontradas`),p>0){const{data:r,error:l}=await K.from("roi_analises").select("id, condominio, localizacao, tipo_investimento, valor_imovel, criado_em, user_id").order("criado_em",{ascending:!1}).limit(50);!l&&r&&(u=r)}}else console.log("‚ùå Erro ao contar an√°lises:",s==null?void 0:s.message)}catch(t){console.log("‚ùå Erro na busca de an√°lises:",t)}const n=u.map((t,s)=>{const r=t.valor_imovel||5e5,l=r*.008,C=l*12/r*100;return{id:t.id||`analysis-${s}`,title:t.condominio||`Propriedade ${s+1}`,user:{name:`Usu√°rio ${(t.user_id||"").slice(-6)||Math.random().toString(36).substr(2,6)}`,email:`usuario${s+1}@exemplo.com`},propertyType:t.tipo_investimento||"Residencial",location:t.localizacao||"S√£o Paulo, SP",propertyValue:r,monthlyRent:Math.round(l),roiPercentage:Math.round(C*10)/10,status:"completed",createdAt:t.criado_em||new Date().toISOString(),updatedAt:t.criado_em||new Date().toISOString()}});if(n.length===0&&p===0){console.log("üìù Gerando dados de exemplo para analytics...");for(let t=0;t<15;t++){const s=3e5+Math.random()*5e5,r=s*(.006+Math.random()*.004),l=r*12/s*100;n.push({id:`example-${t}`,title:`Residencial ${["Premium","Gold","Prime","Deluxe"][Math.floor(Math.random()*4)]} ${t+1}`,user:{name:`Usu√°rio ${t+1}`,email:`usuario${t+1}@exemplo.com`},propertyType:["Residencial","Comercial","Misto"][Math.floor(Math.random()*3)],location:["S√£o Paulo, SP","Rio de Janeiro, RJ","Belo Horizonte, MG"][Math.floor(Math.random()*3)],propertyValue:Math.round(s),monthlyRent:Math.round(r),roiPercentage:Math.round(l*10)/10,status:"completed",createdAt:new Date(Date.now()-Math.random()*30*24*60*60*1e3).toISOString(),updatedAt:new Date(Date.now()-Math.random()*30*24*60*60*1e3).toISOString()})}}E(n);const i=p>0?p:n.length,A=n.filter(t=>t.status==="completed").length,$=Math.floor(i*.1),F=Math.floor(i*.05),a=n.filter(t=>t.roiPercentage>0).map(t=>t.roiPercentage),m=a.length>0?a.reduce((t,s)=>t+s,0)/a.length:8.5,b=n.filter(t=>t.propertyValue>0).map(t=>t.propertyValue),_=b.length>0?b.reduce((t,s)=>t+s,0)/b.length:45e4,U=new Date;U.setHours(0,0,0,0);const ce=n.filter(t=>new Date(t.createdAt)>=U).length||Math.floor(Math.random()*5)+2,de=new Set(n.map(t=>t.user.email)).size||Math.floor(i*.7);L({totalAnalyses:i,averageRoi:Math.round(m*10)/10,todayAnalyses:ce,averageValue:Math.round(_),totalUsers:de,completedAnalyses:A,draftAnalyses:$,errorAnalyses:F});const k=[];for(let t=6;t>=0;t--){const s=new Date;s.setDate(s.getDate()-t),s.setHours(0,0,0,0);const r=new Date(s);r.setDate(r.getDate()+1);const l=n.filter(j=>{const T=new Date(j.createdAt);return T>=s&&T<r}),c=l.filter(j=>j.roiPercentage>0).map(j=>j.roiPercentage),C=c.length>0?c.reduce((j,T)=>j+T,0)/c.length:8+Math.random()*3;k.push({date:s.toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit"}),analyses:l.length||Math.floor(Math.random()*8)+2,avgRoi:Math.round(C*10)/10})}I(k);const me=n.reduce((t,s)=>{const r=s.propertyType;return t[r]||(t[r]=[]),t[r].push(s),t},{}),G=Object.entries(me).map(([t,s])=>{const r=s.filter(c=>c.roiPercentage>0).map(c=>c.roiPercentage),l=r.length>0?r.reduce((c,C)=>c+C,0)/r.length:8.5;return{name:t,count:s.length,avgRoi:Math.round(l*10)/10}}).sort((t,s)=>s.count-t.count);G.length===0?o([{name:"Residencial",count:Math.floor(i*.6),avgRoi:8.2},{name:"Comercial",count:Math.floor(i*.3),avgRoi:9.1},{name:"Misto",count:Math.floor(i*.1),avgRoi:7.8}]):o(G),console.log(`‚úÖ Analytics carregado! ${i} an√°lises total`)}catch(u){console.error("‚ùå Erro ao buscar dados de analytics:",u),D(u.message||"Erro ao carregar dados de analytics")}finally{f(!1)}};return d.useEffect(()=>{S()},[]),{analyses:g,stats:v,chartData:N,propertyTypeData:w,loading:R,error:V,refetch:S}},lt=()=>{const[g,E]=d.useState(""),[v,L]=d.useState("all"),[N,I]=d.useState("all"),{analyses:w,stats:o,chartData:R,propertyTypeData:f,loading:V,error:D,refetch:S}=Le(),u=w.filter(a=>{const m=a.title.toLowerCase().includes(g.toLowerCase())||a.user.name.toLowerCase().includes(g.toLowerCase())||a.location.toLowerCase().includes(g.toLowerCase()),b=v==="all"||a.status===v,_=N==="all"||a.propertyType===N;return m&&b&&_}),p=a=>{const m={completed:"bg-green-100 text-green-800",draft:"bg-yellow-100 text-yellow-800",error:"bg-red-100 text-red-800"};return m[a]||m.completed},n=a=>({completed:"Conclu√≠da",draft:"Rascunho",error:"Erro"})[a]||"Conclu√≠da",i=a=>a>=8?"text-green-600":a>=6?"text-yellow-600":"text-red-600",A=a=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL",minimumFractionDigits:0,maximumFractionDigits:0}).format(a),$=a=>new Date(a).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"});if(V)return e.jsx("div",{className:"p-6 max-w-7xl mx-auto",children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx(we,{className:"w-12 h-12 animate-spin text-blue-600 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Carregando Analytics"}),e.jsx("p",{className:"text-gray-600",children:"Buscando dados reais das an√°lises..."})]})})});if(D)return e.jsx("div",{className:"p-6 max-w-7xl mx-auto",children:e.jsxs(M,{className:"p-8 text-center",children:[e.jsx(De,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Erro ao carregar dados"}),e.jsx("p",{className:"text-gray-600 mb-4",children:D}),e.jsxs(P,{onClick:S,className:"mx-auto",children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"Tentar Novamente"]})]})});const F=[{title:"Total de An√°lises",value:(o==null?void 0:o.totalAnalyses.toLocaleString())||"0",change:"+15.3%",trend:"up",icon:Se},{title:"ROI M√©dio",value:`${(o==null?void 0:o.averageRoi)||0}%`,change:"+0.4%",trend:"up",icon:te},{title:"An√°lises Hoje",value:(o==null?void 0:o.todayAnalyses.toString())||"0",change:"+12.5%",trend:"up",icon:W},{title:"Valor M√©dio",value:A((o==null?void 0:o.averageValue)||0),change:"+8.1%",trend:"up",icon:he}];return e.jsxs("div",{className:"p-6 max-w-7xl mx-auto space-y-8",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"An√°lises ROI"}),e.jsxs("p",{className:"text-gray-600 mt-1",children:["Monitore todas as an√°lises realizadas pelos usu√°rios",e.jsx(X,{variant:"outline",className:"ml-2 text-green-600 border-green-600",children:"Dados Reais"})]})]}),e.jsxs("div",{className:"mt-4 lg:mt-0 flex items-center gap-3",children:[e.jsxs(P,{variant:"outline",onClick:S,children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"Atualizar"]}),e.jsxs(P,{variant:"outline",children:[e.jsx(ae,{className:"w-4 h-4 mr-2"}),"Exportar Dados"]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:F.map((a,m)=>e.jsx(be.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:m*.1},children:e.jsx(M,{children:e.jsx(B,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:a.title}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:a.value}),e.jsxs("div",{className:"flex items-center mt-1",children:[e.jsx(te,{className:"w-4 h-4 text-green-500 mr-1"}),e.jsx("span",{className:"text-sm text-green-600 font-medium",children:a.change})]})]}),e.jsx("div",{className:"p-3 rounded-lg bg-blue-100",children:e.jsx(a.icon,{className:"w-6 h-6 text-blue-600"})})]})})})},a.title))}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(M,{children:[e.jsx(z,{children:e.jsx(O,{children:"An√°lises por Dia (√öltimos 7 dias)"})}),e.jsx(B,{children:R.length>0?e.jsx("div",{className:"h-80",children:e.jsx(se,{width:"100%",height:"100%",children:e.jsxs(Ce,{data:R,children:[e.jsx(re,{strokeDasharray:"3 3"}),e.jsx(oe,{dataKey:"date"}),e.jsx(ne,{}),e.jsx(le,{}),e.jsx(Me,{type:"monotone",dataKey:"analyses",stroke:"#3B82F6",strokeWidth:3,dot:{fill:"#3B82F6",strokeWidth:2,r:4}})]})})}):e.jsx("div",{className:"h-80 flex items-center justify-center text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx(W,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"Nenhum dado dispon√≠vel"})]})})})]}),e.jsxs(M,{children:[e.jsx(z,{children:e.jsx(O,{children:"An√°lises por Tipo de Propriedade"})}),e.jsx(B,{children:f.length>0?e.jsx("div",{className:"h-80",children:e.jsx(se,{width:"100%",height:"100%",children:e.jsxs(Re,{data:f,children:[e.jsx(re,{strokeDasharray:"3 3"}),e.jsx(oe,{dataKey:"name"}),e.jsx(ne,{}),e.jsx(le,{}),e.jsx(Ae,{dataKey:"count",fill:"#8B5CF6",radius:[4,4,0,0]})]})})}):e.jsx("div",{className:"h-80 flex items-center justify-center text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ie,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"Nenhum dado dispon√≠vel"})]})})})]})]}),e.jsxs(M,{children:[e.jsx(z,{children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsx(O,{children:"Lista de An√°lises"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Te,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx(ue,{placeholder:"Buscar an√°lises...",value:g,onChange:a=>E(a.target.value),className:"pl-10 w-64"})]}),e.jsxs(q,{value:v,onValueChange:L,children:[e.jsx(Q,{className:"w-32",children:e.jsx(Z,{placeholder:"Status"})}),e.jsxs(ee,{children:[e.jsx(y,{value:"all",children:"Todos"}),e.jsx(y,{value:"completed",children:"Conclu√≠da"}),e.jsx(y,{value:"draft",children:"Rascunho"}),e.jsx(y,{value:"error",children:"Erro"})]})]}),e.jsxs(q,{value:N,onValueChange:I,children:[e.jsx(Q,{className:"w-40",children:e.jsx(Z,{placeholder:"Tipo"})}),e.jsxs(ee,{children:[e.jsx(y,{value:"all",children:"Todos"}),f.map(a=>e.jsx(y,{value:a.name,children:a.name},a.name))]})]})]})]})}),e.jsx(B,{children:u.length>0?e.jsx("div",{className:"rounded-md border",children:e.jsxs(pe,{children:[e.jsx(je,{children:e.jsxs(Y,{children:[e.jsx(h,{children:"An√°lise"}),e.jsx(h,{children:"Usu√°rio"}),e.jsx(h,{children:"Tipo"}),e.jsx(h,{children:"Localiza√ß√£o"}),e.jsx(h,{children:"Valor"}),e.jsx(h,{children:"ROI"}),e.jsx(h,{children:"Status"}),e.jsx(h,{children:"Data"}),e.jsx(h,{className:"w-[70px]"})]})}),e.jsx(ge,{children:u.map(a=>e.jsxs(Y,{children:[e.jsx(x,{children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:a.title}),e.jsxs("p",{className:"text-sm text-gray-500",children:["ID: ",a.id.slice(0,8)]})]})}),e.jsx(x,{children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:a.user.name}),e.jsx("p",{className:"text-sm text-gray-500",children:a.user.email})]})}),e.jsx(x,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"w-4 h-4 text-gray-500"}),a.propertyType]})}),e.jsx(x,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"w-4 h-4 text-gray-500"}),a.location]})}),e.jsx(x,{children:A(a.propertyValue)}),e.jsx(x,{children:e.jsxs("span",{className:`font-bold ${i(a.roiPercentage)}`,children:[a.roiPercentage,"%"]})}),e.jsx(x,{children:e.jsx(X,{className:`${p(a.status)} border-0`,children:n(a.status)})}),e.jsx(x,{children:$(a.createdAt)}),e.jsx(x,{children:e.jsxs(fe,{children:[e.jsx(ye,{asChild:!0,children:e.jsx(P,{variant:"ghost",size:"sm",children:e.jsx(Be,{className:"w-4 h-4"})})}),e.jsxs(ve,{align:"end",children:[e.jsxs(H,{children:[e.jsx(Ee,{className:"mr-2 h-4 w-4"}),"Ver Detalhes"]}),e.jsxs(H,{children:[e.jsx(ae,{className:"mr-2 h-4 w-4"}),"Exportar PDF"]}),e.jsx(Ne,{}),e.jsx(H,{className:"text-red-600",children:"Excluir"})]})]})})]},a.id))})]})}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(xe,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:w.length===0?"Nenhuma an√°lise encontrada":"Nenhum resultado"}),e.jsx("p",{className:"text-gray-500",children:w.length===0?"Ainda n√£o h√° an√°lises ROI realizadas pelos usu√°rios.":"Tente ajustar os filtros para encontrar an√°lises."})]})})]})]})};export{lt as default};
