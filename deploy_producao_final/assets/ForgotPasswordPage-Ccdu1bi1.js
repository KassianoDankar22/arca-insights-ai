import{j as e}from"./supabase-vendor-vwXl956e.js";import{r as c,e as I}from"./react-vendor-DZvRB87w.js";import{L as u,C as f,a as j,b as g,c as w,d as b,i as N,e as l,A as q,t as s,s as m}from"./index-Df_bSpit.js";import{I as M}from"./input-BaSgXdNs.js";import{A as v,a as R}from"./AnimatedBorderInput-Ic0KG0RF.js";import{m as y}from"./proxy-CqlErGxY.js";import{K as h}from"./key-7JxK1QDe.js";import{C as V}from"./circle-alert-DJmbmDrI.js";import{L as C}from"./loader-circle-Dnz5ZzbO.js";import{M as B}from"./mail-DzfX9Lve.js";import"./ui-vendor-Dea2Gxwc.js";const Z=()=>{const[r,k]=c.useState(""),[n,t]=c.useState(!1),[x,E]=c.useState(""),[P,T]=c.useState(!1),d=I(),S=()=>{const a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let i="";for(let o=0;o<8;o++)i+=a.charAt(Math.floor(Math.random()*a.length));return"Temp"+i},L=async a=>{const{data:i,error:o}=await m.auth.resetPasswordForEmail(a,{redirectTo:`${window.location.origin}/reset-password`});return{data:i,error:o}},A=async()=>{if(!r){s.error("Por favor, insira seu email");return}t(!0);try{const{error:a}=await L(r);if(a)throw a;s.success("Email de recuperação enviado! Verifique sua caixa de entrada."),d("/login",{state:{message:"Verifique seu email para redefinir sua senha"}})}catch(a){console.error("Erro ao solicitar reset de senha:",a),s.error("Não foi possível enviar o email. Tente a opção alternativa abaixo.")}finally{t(!1)}},F=async()=>{if(!r){s.error("Por favor, insira seu email");return}t(!0);try{const{data:a}=await m.from("usuarios").select("id").eq("email",r).single();if(!a){s.error("Email não encontrado no sistema"),t(!1);return}const i=S(),{data:o,error:p}=await m.functions.invoke("reset-user-password",{body:{userId:a.id,newPassword:i,userEmail:r}});if(p)throw p;E(i),T(!0),s.success("Senha temporária gerada com sucesso!")}catch(a){console.error("Erro ao gerar senha temporária:",a),s.error("Não foi possível gerar senha temporária. Entre em contato com o suporte.")}finally{t(!1)}},z=()=>{navigator.clipboard.writeText(x),s.success("Senha copiada para a área de transferência!")};return P?e.jsx(v,{children:e.jsxs(y.div,{className:"w-full max-w-md p-4 z-10",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},children:[e.jsx("div",{className:"flex justify-center mb-10",children:e.jsx(u,{className:"h-20"})}),e.jsxs(f,{className:"backdrop-blur-sm bg-white/90 dark:bg-zinc-900/80 shadow-xl border-white/20 dark:border-zinc-700/30",children:[e.jsxs(j,{children:[e.jsx(g,{className:"text-center",children:"Senha Temporária Gerada"}),e.jsx(w,{className:"text-center",children:"Use esta senha para fazer login e depois altere para uma senha de sua preferência"})]}),e.jsxs(b,{className:"space-y-6",children:[e.jsxs("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(h,{className:"w-5 h-5 text-green-600"}),e.jsx("span",{className:"font-medium text-green-800",children:"Sua nova senha temporária:"})]}),e.jsx("div",{className:"bg-white p-3 rounded border font-mono text-lg tracking-wider text-center border-dashed border-green-300",children:x})]}),e.jsx("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(V,{className:"w-5 h-5 text-blue-600 mt-0.5"}),e.jsxs("div",{className:"text-blue-800 text-sm",children:[e.jsx("p",{className:"font-medium mb-1",children:"Próximos passos:"}),e.jsxs("ol",{className:"list-decimal list-inside space-y-1",children:[e.jsx("li",{children:"Copie a senha acima"}),e.jsx("li",{children:"Vá para a tela de login"}),e.jsxs("li",{children:["Use seu email: ",e.jsx("strong",{children:r})]}),e.jsx("li",{children:"Digite a senha temporária"}),e.jsx("li",{children:"Após o login, vá em Configurações para alterar sua senha"})]})]})]})})]}),e.jsxs(N,{className:"flex flex-col space-y-3",children:[e.jsxs(l,{onClick:z,className:"w-full bg-green-600 hover:bg-green-700",children:[e.jsx(h,{className:"mr-2 h-4 w-4"}),"Copiar Senha"]}),e.jsx(l,{onClick:()=>d("/login"),className:"w-full",children:"Ir para Login"})]})]})]})}):e.jsx(v,{children:e.jsxs(y.div,{className:"w-full max-w-md p-4 z-10",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},children:[e.jsx("div",{className:"flex justify-center mb-10",children:e.jsx(u,{className:"h-20"})}),e.jsxs(f,{className:"backdrop-blur-sm bg-white/90 dark:bg-zinc-900/80 shadow-xl border-white/20 dark:border-zinc-700/30",children:[e.jsxs(j,{children:[e.jsx(g,{children:"Recuperar Senha"}),e.jsx(w,{children:"Digite seu email para recuperar o acesso à sua conta"})]}),e.jsx(b,{className:"space-y-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"email",className:"text-sm font-medium",children:"Email"}),e.jsx(R,{children:e.jsx(M,{id:"email",type:"email",placeholder:"seu@email.com",value:r,onChange:a=>k(a.target.value),required:!0,className:"border-0 focus-visible:ring-0 bg-transparent"})})]})}),e.jsxs(N,{className:"flex flex-col space-y-3",children:[e.jsx(l,{onClick:A,className:"w-full",disabled:n,children:n?e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"mr-2 h-4 w-4 animate-spin"}),"Enviando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"mr-2 h-4 w-4"}),"Enviar Link por Email"]})}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("span",{className:"w-full border-t"})}),e.jsx("div",{className:"relative flex justify-center text-xs uppercase",children:e.jsx("span",{className:"bg-white px-2 text-muted-foreground",children:"ou"})})]}),e.jsx(l,{onClick:F,variant:"outline",className:"w-full",disabled:n,children:n?e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"mr-2 h-4 w-4 animate-spin"}),"Gerando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(h,{className:"mr-2 h-4 w-4"}),"Gerar Senha Temporária"]})}),e.jsxs(l,{type:"button",variant:"ghost",className:"w-full",onClick:()=>d("/login"),children:[e.jsx(q,{className:"mr-2 h-4 w-4"}),"Voltar para Login"]})]})]})]})})};export{Z as default};
