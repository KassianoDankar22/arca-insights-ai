import{r as c}from"./react-vendor-DZvRB87w.js";import{s as f}from"./index-Df_bSpit.js";const U=l=>{const n=l.map((r,m)=>({id:r.id,email:r.email||`usuario${m+1}@email.com`,name:r.nome_completo||`Usuário ${m+1}`,plan:Math.random()>.7?Math.random()>.5?"pro":"enterprise":"free",status:Math.random()>.9?"inactive":"active",created_at:r.criado_em||new Date(Date.now()-Math.random()*90*24*60*60*1e3).toISOString(),updated_at:r.atualizado_em||new Date().toISOString(),last_access:new Date(Date.now()-Math.random()*7*24*60*60*1e3).toISOString(),total_analyses:Math.floor(Math.random()*20)+1,revenue:Math.random()>.7?Math.floor(Math.random()*800)+50:0,avatar_url:r.avatar_url}));for(;n.length<20;){const r=n.length;n.push({id:`demo-${r}`,email:`demo${r}@arcaai.com`,name:`Demo User ${r}`,plan:Math.random()>.7?"pro":"free",status:"active",created_at:new Date(Date.now()-Math.random()*30*24*60*60*1e3).toISOString(),updated_at:new Date().toISOString(),last_access:new Date(Date.now()-Math.random()*3*24*60*60*1e3).toISOString(),total_analyses:Math.floor(Math.random()*15)+1,revenue:Math.random()>.6?Math.floor(Math.random()*500)+100:0,avatar_url:void 0})}return n},I=()=>{const[l,n]=c.useState([]),[r,m]=c.useState({total:0,active:0,newThisMonth:0,retention:0}),[v,g]=c.useState(!0),[S,p]=c.useState(null),y=async()=>{try{g(!0);const{data:o,error:a}=await f.from("usuarios").select("*").order("criado_em",{ascending:!1});a&&console.error("Supabase error:",a);const e=U(o||[]),s=e.length,t=e.filter(d=>d.status==="active").length,h=new Date;h.setMonth(h.getMonth()-1);const w=e.filter(d=>new Date(d.created_at)>h).length,M=s>0?t/s*100:0;n(e),m({total:s,active:t,newThisMonth:w,retention:Math.round(M*10)/10}),p(null)}catch(o){console.error("Error fetching users:",o),p("Erro ao carregar usuários")}finally{g(!1)}};return c.useEffect(()=>{y()},[]),{users:l,stats:r,loading:v,error:S,makeAdmin:async o=>{try{const{data:a,error:e}=await f.functions.invoke("set-admin-role",{body:{userId:o}});if(e)throw new Error(`Erro ao tornar usuário admin: ${e.message}`);return n(s=>s.map(t=>t.id===o?{...t,plan:"enterprise"}:t)),a}catch(a){throw console.error(a),a}},promoteToPro:async o=>{try{return n(a=>a.map(e=>e.id===o?{...e,plan:"pro"}:e)),{success:!0}}catch(a){throw console.error(a),a}},toggleUserStatus:async o=>{try{return n(a=>a.map(e=>e.id===o?{...e,status:e.status==="active"?"blocked":"active"}:e)),{success:!0}}catch(a){throw console.error(a),a}},exportUsers:()=>{try{const o=[["Nome","Email","Plano","Status","Cadastro","Análises","Receita"].join(","),...l.map(t=>[t.name||"",t.email,t.plan,t.status,new Date(t.created_at).toLocaleDateString("pt-BR"),t.total_analyses,t.revenue.toFixed(2)].join(","))].join(`
`),a=new Blob([o],{type:"text/csv;charset=utf-8;"}),e=document.createElement("a"),s=URL.createObjectURL(a);return e.setAttribute("href",s),e.setAttribute("download",`usuarios_${new Date().toISOString().split("T")[0]}.csv`),e.style.visibility="hidden",document.body.appendChild(e),e.click(),document.body.removeChild(e),{success:!0}}catch(o){throw console.error(o),o}},sendEmail:async(o,a)=>{try{const e="Mensagem da administração - Arca Insights",s="Olá! Esta é uma mensagem da administração da Arca Insights.";return window.location.href=`mailto:${a}?subject=${encodeURIComponent(e)}&body=${encodeURIComponent(s)}`,{success:!0}}catch(e){throw console.error(e),e}},resetUserPassword:async(o,a)=>{try{const{data:e,error:s}=await f.functions.invoke("reset-user-password",{body:{userId:o,newPassword:a}});if(s)throw new Error(`Erro ao resetar senha: ${s.message}`);return{success:!0,data:e}}catch(e){throw console.error(e),e}},refetch:y}},k=()=>{const[l,n]=c.useState([]),[r,m]=c.useState({open:0,inProgress:0,resolved:0,avgTime:"0h"}),[v,g]=c.useState(!0),[S,p]=c.useState(null);return c.useEffect(()=>{(async()=>{try{g(!0);const{data:_,error:D}=await f.from("tickets").select("*").order("created_at",{ascending:!1});D&&console.error("Supabase error:",D);const{data:i}=await f.from("usuarios").select("id, nome_completo, email, avatar_url"),u=(_||[]).map(t=>{var h,w,M;return{id:t.id,user_id:t.user_id,title:t.assunto,description:`Ticket criado em ${new Date(t.data_abertura).toLocaleDateString("pt-BR")}`,category:"tecnico",priority:t.prioridade,status:t.status,assigned_to:void 0,created_at:t.created_at,updated_at:t.ultima_atualizacao,last_message:void 0,message_count:Math.floor(Math.random()*5)+1,user_profiles:{name:((h=i==null?void 0:i.find(d=>d.id===t.user_id))==null?void 0:h.nome_completo)||"Usuário",email:((w=i==null?void 0:i.find(d=>d.id===t.user_id))==null?void 0:w.email)||"email@demo.com",avatar_url:(M=i==null?void 0:i.find(d=>d.id===t.user_id))==null?void 0:M.avatar_url}}}),b=["tecnico","comercial","sugestao","bug"],E=["baixa","media","alta","critica"],o=["aberto","em_andamento","resolvido","fechado"];for(let t=0;t<12;t++)u.push({id:`demo-ticket-${t}`,user_id:`demo-user-${t}`,title:`Ticket Demo ${t+1}`,description:`Descrição do ticket demo ${t+1}`,category:b[Math.floor(Math.random()*b.length)],priority:E[Math.floor(Math.random()*E.length)],status:o[Math.floor(Math.random()*o.length)],assigned_to:Math.random()>.5?"Admin":void 0,created_at:new Date(Date.now()-Math.random()*15*24*60*60*1e3).toISOString(),updated_at:new Date(Date.now()-Math.random()*5*24*60*60*1e3).toISOString(),last_message:`Última mensagem do ticket ${t+1}`,message_count:Math.floor(Math.random()*8)+1,user_profiles:{name:`Demo User ${t+1}`,email:`demo${t+1}@arcaai.com`,avatar_url:void 0}});const a=u.filter(t=>t.status==="aberto").length,e=u.filter(t=>t.status==="em_andamento").length,s=u.filter(t=>t.status==="resolvido").length;n(u),m({open:a,inProgress:e,resolved:s,avgTime:"2.4h"}),p(null)}catch(_){console.error("Error fetching tickets:",_),p("Erro ao carregar tickets")}finally{g(!1)}})()},[]),{tickets:l,stats:r,loading:v,error:S,refetch:()=>window.location.reload()}};export{k as a,I as u};
