import{r as o}from"./react-vendor-DZvRB87w.js";import{s as w}from"./index-Bcg3-yyF.js";const T=d=>{const s=d.map((e,i)=>({id:e.id,email:e.email||`usuario${i+1}@email.com`,name:e.nome_completo||`Usuário ${i+1}`,plan:Math.random()>.7?Math.random()>.5?"pro":"enterprise":"free",status:Math.random()>.9?"inactive":"active",created_at:e.criado_em||new Date(Date.now()-Math.random()*90*24*60*60*1e3).toISOString(),updated_at:e.atualizado_em||new Date().toISOString(),last_access:new Date(Date.now()-Math.random()*7*24*60*60*1e3).toISOString(),total_analyses:Math.floor(Math.random()*20)+1,revenue:Math.random()>.7?Math.floor(Math.random()*800)+50:0,avatar_url:e.avatar_url}));for(;s.length<20;){const e=s.length;s.push({id:`demo-${e}`,email:`demo${e}@arcaai.com`,name:`Demo User ${e}`,plan:Math.random()>.7?"pro":"free",status:"active",created_at:new Date(Date.now()-Math.random()*30*24*60*60*1e3).toISOString(),updated_at:new Date().toISOString(),last_access:new Date(Date.now()-Math.random()*3*24*60*60*1e3).toISOString(),total_analyses:Math.floor(Math.random()*15)+1,revenue:Math.random()>.6?Math.floor(Math.random()*500)+100:0,avatar_url:void 0})}return s},I=()=>{const[d,s]=o.useState([]),[e,i]=o.useState({total:0,active:0,newThisMonth:0,retention:0}),[p,l]=o.useState(!0),[M,m]=o.useState(null);return o.useEffect(()=>{(async()=>{try{l(!0);const{data:n,error:u}=await w.from("usuarios").select("*").order("criado_em",{ascending:!1});u&&console.error("Supabase error:",u);const a=T(n||[]),r=a.length,h=a.filter(f=>f.status==="active").length,c=new Date;c.setMonth(c.getMonth()-1);const _=a.filter(f=>new Date(f.created_at)>c).length,S=r>0?h/r*100:0;s(a),i({total:r,active:h,newThisMonth:_,retention:Math.round(S*10)/10}),m(null)}catch(n){console.error("Error fetching users:",n),m("Erro ao carregar usuários")}finally{l(!1)}})()},[]),{users:d,stats:e,loading:p,error:M,refetch:()=>window.location.reload()}},O=()=>{const[d,s]=o.useState([]),[e,i]=o.useState({open:0,inProgress:0,resolved:0,avgTime:"0h"}),[p,l]=o.useState(!0),[M,m]=o.useState(null);return o.useEffect(()=>{(async()=>{try{l(!0);const{data:n,error:u}=await w.from("tickets").select("*").order("created_at",{ascending:!1});u&&console.error("Supabase error:",u);const{data:a}=await w.from("usuarios").select("id, nome_completo, email, avatar_url"),r=(n||[]).map(t=>{var v,D,$;return{id:t.id,user_id:t.user_id,title:t.assunto,description:`Ticket criado em ${new Date(t.data_abertura).toLocaleDateString("pt-BR")}`,category:"tecnico",priority:t.prioridade,status:t.status,assigned_to:void 0,created_at:t.created_at,updated_at:t.ultima_atualizacao,last_message:void 0,message_count:Math.floor(Math.random()*5)+1,user_profiles:{name:((v=a==null?void 0:a.find(g=>g.id===t.user_id))==null?void 0:v.nome_completo)||"Usuário",email:((D=a==null?void 0:a.find(g=>g.id===t.user_id))==null?void 0:D.email)||"email@demo.com",avatar_url:($=a==null?void 0:a.find(g=>g.id===t.user_id))==null?void 0:$.avatar_url}}}),h=["tecnico","comercial","sugestao","bug"],c=["baixa","media","alta","critica"],_=["aberto","em_andamento","resolvido","fechado"];for(let t=0;t<12;t++)r.push({id:`demo-ticket-${t}`,user_id:`demo-user-${t}`,title:`Ticket Demo ${t+1}`,description:`Descrição do ticket demo ${t+1}`,category:h[Math.floor(Math.random()*h.length)],priority:c[Math.floor(Math.random()*c.length)],status:_[Math.floor(Math.random()*_.length)],assigned_to:Math.random()>.5?"Admin":void 0,created_at:new Date(Date.now()-Math.random()*15*24*60*60*1e3).toISOString(),updated_at:new Date(Date.now()-Math.random()*5*24*60*60*1e3).toISOString(),last_message:`Última mensagem do ticket ${t+1}`,message_count:Math.floor(Math.random()*8)+1,user_profiles:{name:`Demo User ${t+1}`,email:`demo${t+1}@arcaai.com`,avatar_url:void 0}});const S=r.filter(t=>t.status==="aberto").length,f=r.filter(t=>t.status==="em_andamento").length,E=r.filter(t=>t.status==="resolvido").length;s(r),i({open:S,inProgress:f,resolved:E,avgTime:"2.4h"}),m(null)}catch(n){console.error("Error fetching tickets:",n),m("Erro ao carregar tickets")}finally{l(!1)}})()},[]),{tickets:d,stats:e,loading:p,error:M,refetch:()=>window.location.reload()}};export{O as a,I as u};
