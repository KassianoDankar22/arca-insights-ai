import{j as e}from"./supabase-vendor-vwXl956e.js";import{r as m,L as M}from"./react-vendor-DZvRB87w.js";import{u as $,s as R,t as C,B as I,e as F,C as h,d as p,x as G,a as y,b as L,D as O,h as Q}from"./index-Df_bSpit.js";import{I as E}from"./input-BaSgXdNs.js";import{L as S}from"./label-DvsDVWlE.js";import{S as H,a as J,b as W,c as K,d as k}from"./select-DWYjgQBo.js";import{u as X}from"./useFinanceiro-CoZRCXiW.js";import{L as Y}from"./loader-circle-Dnz5ZzbO.js";import{P as ee}from"./plus-Cf9uTjEE.js";import{C as se,U as A}from"./users-round-Dv5Ef6_E.js";import{C as ae}from"./calendar-CQNTrNBE.js";import{T as U}from"./trending-up-D6UT933U.js";import{T as te}from"./target-CTHz11nP.js";import{A as V}from"./activity-BtNb_0BM.js";import{C as re}from"./circle-alert-DJmbmDrI.js";import"./ui-vendor-Dea2Gxwc.js";import"./index-v7iOeiPF.js";import"./chevron-down-Bc7oyTHl.js";import"./check-Cr6J53Lh.js";import"./chevron-up-BR0CPyY0.js";const oe=()=>{const{user:c}=$(),[a,f]=m.useState([]),[T,b]=m.useState(null),[j,D]=m.useState(!0),[_,v]=m.useState(null),[x,l]=m.useState(!1);m.useEffect(()=>{c&&r()},[c]);const w=()=>[{id:"1",name:"João Silva",email:"joao@email.com",phone:"(11) 99999-9999",company:"Silva Investimentos",source:"website",status:"qualified",value:35e4,notes:"Interessado em apartamento no centro",created_at:new Date(Date.now()-2*24*60*60*1e3).toISOString(),updated_at:new Date(Date.now()-1*24*60*60*1e3).toISOString()},{id:"2",name:"Maria Santos",email:"maria@empresa.com",phone:"(11) 88888-8888",company:"Santos & Cia",source:"referral",status:"proposal",value:28e4,notes:"Procura casa com jardim",created_at:new Date(Date.now()-3*24*60*60*1e3).toISOString(),updated_at:new Date(Date.now()-2*24*60*60*1e3).toISOString()},{id:"3",name:"Pedro Costa",email:"pedro@email.com",phone:"(11) 77777-7777",source:"social",status:"new",value:42e4,notes:"Primeiro contato via Instagram",created_at:new Date(Date.now()-1*24*60*60*1e3).toISOString(),updated_at:new Date(Date.now()-1*24*60*60*1e3).toISOString()}],i=()=>({totalLeads:47,newLeads:12,qualifiedLeads:8,convertedLeads:5,totalValue:125e4,conversionRate:15.8}),r=async()=>{if(c){D(!0),v(null);try{const{data:n,error:o}=await R.from("crm_leads").select("*").eq("user_id",c.id).order("created_at",{ascending:!1});if(o)console.error("Error fetching CRM leads:",o),f(w()),b(i()),l(!0);else{const d=(n||[]).map(t=>({id:t.id,name:t.name,email:t.email,phone:t.phone,company:t.company,source:t.source,status:t.status,value:t.value,notes:t.notes,created_at:t.created_at,updated_at:t.updated_at}));f(d),g(d),l(!1),console.log("✅ CRM usando dados reais do Supabase")}}catch(n){console.error("Error fetching CRM data:",n),f(w()),b(i()),l(!0),v(n.message)}finally{D(!1)}}},g=n=>{const o=n.length,d=n.filter(N=>N.status==="new").length,t=n.filter(N=>N.status==="qualified").length,P=n.filter(N=>N.status==="won").length,B=n.reduce((N,Z)=>N+(Z.value||0),0),z=o>0?P/o*100:0;b({totalLeads:o,newLeads:d,qualifiedLeads:t,convertedLeads:P,totalValue:B,conversionRate:Math.round(z*100)/100})};return{leads:a,stats:T,loading:j,error:_,isUsingMockData:x,createLead:async n=>{if(!c)throw new Error("User not authenticated");try{const o={...n,user_id:c.id},{data:d,error:t}=await R.from("crm_leads").insert([o]).select().single();if(t)throw console.error("Error creating lead:",t),t;return await r(),C.success("Lead criado com sucesso!"),console.log("✅ Lead criado no Supabase:",d),d}catch(o){throw console.error("Error creating lead:",o),C.error("Erro ao criar lead"),o}},updateLead:async(n,o)=>{if(!c)throw new Error("User not authenticated");try{const{data:d,error:t}=await R.from("crm_leads").update(o).eq("id",n).eq("user_id",c.id).select().single();if(t)throw console.error("Error updating lead:",t),t;return await r(),C.success("Lead atualizado com sucesso!"),console.log("✅ Lead atualizado no Supabase:",d),d}catch(d){throw console.error("Error updating lead:",d),C.error("Erro ao atualizar lead"),d}},deleteLead:async n=>{if(!c)throw new Error("User not authenticated");try{const{error:o}=await R.from("crm_leads").delete().eq("id",n).eq("user_id",c.id);if(o)throw console.error("Error deleting lead:",o),o;await r(),C.success("Lead excluído com sucesso!"),console.log("✅ Lead excluído do Supabase")}catch(o){throw console.error("Error deleting lead:",o),C.error("Erro ao excluir lead"),o}},refreshData:r}},ne=()=>{const[c,a]=m.useState([]),[f,T]=m.useState(null),[b,j]=m.useState(!0),[D,_]=m.useState(null),{user:v}=$(),x=async()=>{if(v)try{j(!0),_(null);const i=[{id:"1",title:"Erro ao exportar PDF",description:"Não consigo exportar minha análise ROI em PDF",category:"technical",priority:"medium",status:"open",created_at:"2024-01-15T10:00:00Z",updated_at:"2024-01-15T10:00:00Z"},{id:"2",title:"Dúvida sobre plano Pro",description:"Gostaria de saber mais sobre os benefícios do plano Pro",category:"billing",priority:"low",status:"in_progress",created_at:"2024-01-14T14:30:00Z",updated_at:"2024-01-15T09:15:00Z"},{id:"3",title:"Sugestão de nova funcionalidade",description:"Seria interessante ter comparação entre propriedades",category:"feature",priority:"low",status:"resolved",created_at:"2024-01-12T16:45:00Z",updated_at:"2024-01-14T11:20:00Z"}];a(i);const r=i.filter(u=>u.status==="open").length,g=i.filter(u=>u.status==="in_progress").length,s=i.filter(u=>u.status==="resolved").length;T({openTickets:r,inProgressTickets:g,resolvedTickets:s,averageResponseTime:4.5})}catch(i){console.error("Erro ao buscar dados de suporte:",i),_("Erro ao carregar tickets de suporte")}finally{j(!1)}},l=async i=>{const r={...i,id:Date.now().toString(),status:"open",created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return a(g=>[r,...g]),await x(),r},w=async(i,r)=>{a(g=>g.map(s=>s.id===i?{...s,status:r,updated_at:new Date().toISOString()}:s)),await x()};return m.useEffect(()=>{x()},[v]),{tickets:c,stats:f,loading:b,error:D,createTicket:l,updateTicketStatus:w,refetch:x}},De=()=>{const{leads:c,stats:a,loading:f,createLead:T,isUsingMockData:b}=oe(),{stats:j,transactions:D}=X(),{tickets:_}=ne(),[v,x]=m.useState(!1),[l,w]=m.useState({name:"",email:"",phone:"",company:"",source:"website",status:"new",value:0,notes:""}),i=[...D.slice(0,2).map(s=>({id:s.id,description:`Transação: ${s.description}`,date:new Date(s.created_at).toLocaleDateString("pt-BR"),type:"transaction"})),..._.slice(0,2).map(s=>({id:s.id,description:`Ticket: ${s.title}`,date:new Date(s.created_at).toLocaleDateString("pt-BR"),type:"ticket"})),...c.slice(0,2).map(s=>({id:s.id,description:`Lead: ${s.name} (${s.status})`,date:new Date(s.created_at).toLocaleDateString("pt-BR"),type:"lead"}))],r=(s,u)=>{w(q=>({...q,[s]:u}))},g=async s=>{if(s.preventDefault(),!l.name.trim()){C.error("Nome é obrigatório");return}try{await T(l),w({name:"",email:"",phone:"",company:"",source:"website",status:"new",value:0,notes:""}),x(!1)}catch(u){console.error("Erro ao criar lead:",u)}};return f?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-white flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Y,{className:"h-8 w-8 animate-spin mx-auto mb-4 text-blue-600"}),e.jsx("p",{className:"text-gray-600",children:"Carregando dados do CRM..."})]})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-white p-4 md:p-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"CRM Dashboard"}),e.jsxs("p",{className:"text-gray-600",children:["Gerencie leads, prospects e relacionamentos com clientes",b&&e.jsx(I,{variant:"outline",className:"ml-2 text-orange-600 border-orange-600",children:"Dados Simulados"})]})]}),e.jsxs(F,{variant:"default",onClick:()=>x(!0),className:"bg-arca-main hover:bg-arca-dark",children:[e.jsx(ee,{className:"h-4 w-4 mr-2"}),"Novo Lead"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsx(M,{to:"/crm/leads",children:e.jsx(h,{className:"hover:shadow-lg transition-shadow cursor-pointer bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200",children:e.jsx(p,{className:"p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(G,{className:"h-8 w-8 text-blue-600 mr-3"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-blue-900",children:"Gestão de Leads"}),e.jsx("p",{className:"text-sm text-blue-700",children:"Gerencie e acompanhe seus leads"}),e.jsxs(I,{className:"mt-1 bg-blue-200 text-blue-800",children:[a.totalLeads," leads"]})]})]})})})}),e.jsx(M,{to:"/crm/funil",children:e.jsx(h,{className:"hover:shadow-lg transition-shadow cursor-pointer bg-gradient-to-br from-purple-50 to-purple-100 border-purple-200",children:e.jsx(p,{className:"p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(se,{className:"h-8 w-8 text-purple-600 mr-3"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-purple-900",children:"Funil de Vendas"}),e.jsx("p",{className:"text-sm text-purple-700",children:"Visualize seu pipeline"}),e.jsxs(I,{className:"mt-1 bg-purple-200 text-purple-800",children:[a.conversionRate,"% conversão"]})]})]})})})}),e.jsx(M,{to:"/crm/agenda",children:e.jsx(h,{className:"hover:shadow-lg transition-shadow cursor-pointer bg-gradient-to-br from-green-50 to-green-100 border-green-200",children:e.jsx(p,{className:"p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(ae,{className:"h-8 w-8 text-green-600 mr-3"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-green-900",children:"Agenda e Tarefas"}),e.jsx("p",{className:"text-sm text-green-700",children:"Organize seus compromissos"}),e.jsx(I,{className:"mt-1 bg-green-200 text-green-800",children:"3 hoje"})]})]})})})})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(h,{className:"bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200",children:[e.jsxs(y,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(L,{className:"text-sm font-medium text-blue-900",children:"Novos Leads (30d)"}),e.jsx(A,{className:"h-5 w-5 text-blue-600"})]}),e.jsxs(p,{children:[e.jsx("div",{className:"text-2xl font-bold text-blue-900",children:a.newLeads}),e.jsxs("div",{className:"flex items-center text-xs text-blue-700",children:[e.jsx(U,{className:"h-3 w-3 mr-1"}),"+23% vs mês anterior"]})]})]}),e.jsxs(h,{className:"bg-gradient-to-br from-green-50 to-green-100 border-green-200",children:[e.jsxs(y,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(L,{className:"text-sm font-medium text-green-900",children:"Taxa de Conversão"}),e.jsx(te,{className:"h-5 w-5 text-green-600"})]}),e.jsxs(p,{children:[e.jsxs("div",{className:"text-2xl font-bold text-green-900",children:[a.conversionRate,"%"]}),e.jsxs("div",{className:"flex items-center text-xs text-green-700",children:[e.jsx(U,{className:"h-3 w-3 mr-1"}),"Meta: 20%"]})]})]}),e.jsxs(h,{className:"bg-gradient-to-br from-purple-50 to-purple-100 border-purple-200",children:[e.jsxs(y,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(L,{className:"text-sm font-medium text-purple-900",children:"Leads Qualificados"}),e.jsx(V,{className:"h-5 w-5 text-purple-600"})]}),e.jsxs(p,{children:[e.jsx("div",{className:"text-2xl font-bold text-purple-900",children:a.qualifiedLeads}),e.jsxs("div",{className:"text-xs text-purple-700",children:[a.convertedLeads," convertidos"]})]})]}),e.jsxs(h,{className:"bg-gradient-to-br from-orange-50 to-orange-100 border-orange-200",children:[e.jsxs(y,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(L,{className:"text-sm font-medium text-orange-900",children:"Valor Total"}),e.jsx(O,{className:"h-5 w-5 text-orange-600"})]}),e.jsxs(p,{children:[e.jsxs("div",{className:"text-2xl font-bold text-orange-900",children:["R$ ",((j==null?void 0:j.totalIncome)||0).toLocaleString("pt-BR")]}),e.jsx("div",{className:"text-xs text-orange-700",children:"Pipeline total"})]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs(h,{children:[e.jsx(y,{children:e.jsxs(L,{className:"flex items-center",children:[e.jsx(V,{className:"h-5 w-5 mr-2 text-blue-600"}),"Atividades Recentes"]})}),e.jsx(p,{children:e.jsx("div",{className:"space-y-4",children:i.map(s=>e.jsxs("div",{className:"flex items-start space-x-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:`p-2 rounded-full ${s.type==="lead"?"bg-blue-100 text-blue-600":s.type==="ticket"?"bg-yellow-100 text-yellow-600":"bg-green-100 text-green-600"}`,children:s.type==="lead"?e.jsx(A,{className:"h-4 w-4"}):s.type==="ticket"?e.jsx(re,{className:"h-4 w-4"}):e.jsx(O,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm text-gray-700",children:s.description}),e.jsx("p",{className:"text-xs text-gray-500",children:s.date})]})]},s.id))})})]}),e.jsxs(h,{children:[e.jsx(y,{children:e.jsxs(L,{className:"flex items-center",children:[e.jsx(Q,{className:"h-5 w-5 mr-2 text-purple-600"}),"Distribuição de Leads"]})}),e.jsx(p,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Novos"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-20 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-arca-main h-2 rounded-full",style:{width:`${a.newLeads/Math.max(a.totalLeads,1)*100}%`}})}),e.jsx("span",{className:"text-sm font-medium",children:a.newLeads})]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Qualificados"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-20 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-arca-main h-2 rounded-full",style:{width:`${a.qualifiedLeads/Math.max(a.totalLeads,1)*100}%`}})}),e.jsx("span",{className:"text-sm font-medium",children:a.qualifiedLeads})]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Convertidos"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-20 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-arca-main h-2 rounded-full",style:{width:`${a.convertedLeads/Math.max(a.totalLeads,1)*100}%`}})}),e.jsx("span",{className:"text-sm font-medium",children:a.convertedLeads})]})]})]})})]})]}),v&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs(h,{className:"w-full max-w-md mx-4",children:[e.jsx(y,{children:e.jsx(L,{children:"Adicionar Novo Lead"})}),e.jsx(p,{children:e.jsxs("form",{onSubmit:g,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(S,{htmlFor:"name",children:"Nome *"}),e.jsx(E,{id:"name",value:l.name,onChange:s=>r("name",s.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx(S,{htmlFor:"email",children:"Email"}),e.jsx(E,{id:"email",type:"email",value:l.email,onChange:s=>r("email",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(S,{htmlFor:"phone",children:"Telefone"}),e.jsx(E,{id:"phone",value:l.phone,onChange:s=>r("phone",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(S,{htmlFor:"company",children:"Empresa"}),e.jsx(E,{id:"company",value:l.company,onChange:s=>r("company",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(S,{htmlFor:"source",children:"Fonte"}),e.jsxs(H,{value:l.source,onValueChange:s=>r("source",s),children:[e.jsx(J,{children:e.jsx(W,{})}),e.jsxs(K,{children:[e.jsx(k,{value:"website",children:"Website"}),e.jsx(k,{value:"referral",children:"Indicação"}),e.jsx(k,{value:"social",children:"Redes Sociais"}),e.jsx(k,{value:"email",children:"Email Marketing"}),e.jsx(k,{value:"phone",children:"Telefone"})]})]})]}),e.jsxs("div",{children:[e.jsx(S,{htmlFor:"value",children:"Valor Potencial (R$)"}),e.jsx(E,{id:"value",type:"number",value:l.value,onChange:s=>r("value",parseFloat(s.target.value)||0)})]}),e.jsxs("div",{children:[e.jsx(S,{htmlFor:"notes",children:"Observações"}),e.jsx(E,{id:"notes",value:l.notes,onChange:s=>r("notes",s.target.value),placeholder:"Adicione notas sobre este lead..."})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(F,{type:"button",variant:"outline",onClick:()=>x(!1),children:"Cancelar"}),e.jsx(F,{type:"submit",children:"Adicionar Lead"})]})]})})]})})]})})};export{De as default};
