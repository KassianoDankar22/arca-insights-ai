import{r as o}from"./react-vendor-DZvRB87w.js";import{u as x,s as g,t as f}from"./index-DpL_m2zY.js";const D=()=>{const[y,n]=o.useState([]),[T,E]=o.useState(null),[h,l]=o.useState(!0),[_,p]=o.useState(null),[S,c]=o.useState(!1),{user:s}=x(),m=()=>[{id:"1",type:"income",category:"Aluguel",amount:2500,description:"Aluguel Apartamento Centro",date:"2024-01-15",created_at:"2024-01-15T10:00:00Z"},{id:"2",type:"expense",category:"Manutenção",amount:450,description:"Reparo elétrico",date:"2024-01-10",created_at:"2024-01-10T14:00:00Z"},{id:"3",type:"income",category:"Aluguel",amount:1800,description:"Aluguel Casa Vila Nova",date:"2024-01-12",created_at:"2024-01-12T09:00:00Z"},{id:"4",type:"expense",category:"Impostos",amount:320,description:"IPTU",date:"2024-01-08",created_at:"2024-01-08T16:00:00Z"},{id:"5",type:"income",category:"Venda",amount:15e3,description:"Comissão venda apartamento",date:"2024-01-20",created_at:"2024-01-20T11:00:00Z"}],i=async()=>{if(s)try{l(!0),p(null);const{data:r,error:t}=await g.from("transactions").select("*").eq("user_id",s.id).order("created_at",{ascending:!1});if(t){console.error("Error fetching transactions:",t);const a=m();n(a),d(a),c(!0)}else{const a=(r||[]).map(e=>({id:e.id,type:e.type,category:e.category,amount:e.amount,description:e.description,date:e.date,created_at:e.created_at}));n(a),d(a),c(!1),console.log("✅ Financeiro usando dados reais do Supabase")}}catch(r){console.error("Erro ao buscar dados financeiros:",r);const t=m();n(t),d(t),c(!0),p("Erro ao carregar dados financeiros")}finally{l(!1)}},d=r=>{const t=r.filter(e=>e.type==="income").reduce((e,u)=>e+u.amount,0),a=r.filter(e=>e.type==="expense").reduce((e,u)=>e+u.amount,0);E({totalIncome:t,totalExpenses:a,netProfit:t-a,monthlyIncome:t,pendingTransactions:0})},w=async r=>{if(!s)throw new Error("User not authenticated");try{const t={...r,user_id:s.id},{data:a,error:e}=await g.from("transactions").insert([t]).select().single();if(e)throw console.error("Error creating transaction:",e),e;return await i(),f.success("Transação criada com sucesso!"),console.log("✅ Transação criada no Supabase:",a),a}catch(t){throw console.error("Error creating transaction:",t),f.error("Erro ao criar transação"),t}};return o.useEffect(()=>{i()},[s]),{transactions:y,stats:T,loading:h,error:_,isUsingMockData:S,addTransaction:w,refetch:i}};export{D as u};
