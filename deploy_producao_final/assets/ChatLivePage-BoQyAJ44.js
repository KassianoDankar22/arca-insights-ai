import{j as e}from"./supabase-vendor-vwXl956e.js";import{r as n}from"./react-vendor-DZvRB87w.js";import{u as $,C as h,a as p,b as f,d as g,e as l,B as O,c as _,v as k,y as w,z as b}from"./index-DpL_m2zY.js";import{I as E}from"./input-DGm6H34X.js";import{C as z}from"./circle-alert-CuOU8fz6.js";import{M as R}from"./mail-D4bdVGOw.js";import{P as L}from"./phone-BeF8MCkU.js";import{C as F}from"./clock-lvYXaFmX.js";import{M as P,a as V}from"./minimize-2-Dn4bmwVL.js";import{U}from"./user-DgaYMSkE.js";import{S as B}from"./send-CGST6Hao.js";import"./ui-vendor-Dea2Gxwc.js";const te=()=>{const{user:i}=$(),[a,c]=n.useState(null),[o,N]=n.useState(""),[m]=n.useState(!0),[x,S]=n.useState(!1),[C,J]=n.useState(!1),j=n.useRef(null),[v]=n.useState({available:!0,averageResponseTime:"2-5 minutos",agentsOnline:3});n.useEffect(()=>{if(i){const s=localStorage.getItem(`chat_session_${i.id}`);if(s){const t=JSON.parse(s);t.startedAt=new Date(t.startedAt),t.lastActivity=new Date(t.lastActivity),t.messages=t.messages.map(r=>({...r,timestamp:new Date(r.timestamp)})),c(t)}}},[i]),n.useEffect(()=>{j.current&&j.current.scrollIntoView({behavior:"smooth"})},[a==null?void 0:a.messages]),n.useEffect(()=>{if(!a||a.status==="closed")return;const s=setInterval(()=>{Math.random()<.02&&y("Obrigado por entrar em contato! Como posso ajudá-lo hoje?")},1e3);return()=>clearInterval(s)},[a]);const I=()=>{var t;if(!i)return;const s={id:`chat_${Date.now()}`,userId:i.id,userName:((t=i.email)==null?void 0:t.split("@")[0])||"Usuário",userEmail:i.email||"",status:"waiting",messages:[],startedAt:new Date,lastActivity:new Date};c(s),d(s),setTimeout(()=>{const r={id:`msg_${Date.now()}`,senderId:"system",senderName:"Sistema",senderType:"admin",message:"Olá! Você iniciou um chat com nosso suporte. Um de nossos agentes responderá em breve.",timestamp:new Date,read:!0},u={...s,messages:[r],lastActivity:new Date};c(u),d(u)},1e3)},A=()=>{if(!o.trim()||!a||!i)return;const s={id:`msg_${Date.now()}`,senderId:i.id,senderName:a.userName,senderType:"user",message:o.trim(),timestamp:new Date,read:!1},t={...a,messages:[...a.messages,s],status:"active",lastActivity:new Date};c(t),d(t),N(""),(o.toLowerCase().includes("olá")||o.toLowerCase().includes("oi"))&&setTimeout(()=>{y("Olá! Como posso ajudá-lo hoje?")},2e3)},y=s=>{if(!a)return;const t={id:`msg_${Date.now()}`,senderId:"admin",senderName:"Suporte Arca",senderType:"admin",message:s,timestamp:new Date,read:!0},r={...a,messages:[...a.messages,t],status:"active",lastActivity:new Date};c(r),d(r)},D=()=>{if(!a)return;const s={...a,status:"closed",lastActivity:new Date};c(s),d(s)},d=s=>{localStorage.setItem(`chat_session_${s.userId}`,JSON.stringify(s));const t=JSON.parse(localStorage.getItem("admin_live_chats")||"[]"),r=t.findIndex(u=>u.id===s.id);r>=0?t[r]=s:t.push(s),localStorage.setItem("admin_live_chats",JSON.stringify(t))},T=s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),A())},M=s=>s.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"});return i?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-blue-50 p-4",children:e.jsx("div",{className:"max-w-4xl mx-auto",children:a?e.jsxs(h,{className:`w-full transition-all duration-300 ${x?"h-16":"h-[600px]"}`,children:[e.jsxs(p,{className:"flex flex-row items-center justify-between py-3 px-4 border-b",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full animate-pulse"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"Chat ao Vivo"}),e.jsx("p",{className:"text-sm text-gray-500",children:a.status==="waiting"?"Aguardando agente...":a.status==="active"?"Conectado com suporte":"Chat encerrado"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(l,{variant:"ghost",size:"sm",onClick:()=>S(!x),children:x?e.jsx(P,{className:"w-4 h-4"}):e.jsx(V,{className:"w-4 h-4"})}),a.status!=="closed"&&e.jsx(l,{variant:"ghost",size:"sm",onClick:D,children:"✕"})]})]}),!x&&e.jsxs(g,{className:"p-0 flex flex-col h-[calc(600px-80px)]",children:[e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[a.messages.map(s=>e.jsx("div",{className:`flex ${s.senderType==="user"?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`flex items-start gap-2 max-w-[70%] ${s.senderType==="user"?"flex-row-reverse":""}`,children:[e.jsx(w,{className:"w-8 h-8",children:e.jsx(b,{className:s.senderType==="user"?"bg-blue-500 text-white":"bg-gray-500 text-white",children:s.senderType==="user"?e.jsx(U,{className:"w-4 h-4"}):"A"})}),e.jsxs("div",{className:`rounded-lg p-3 ${s.senderType==="user"?"bg-blue-500 text-white":"bg-gray-100 text-gray-900"}`,children:[e.jsx("p",{className:"text-sm",children:s.message}),e.jsx("p",{className:`text-xs mt-1 ${s.senderType==="user"?"text-blue-100":"text-gray-500"}`,children:M(s.timestamp)})]})]})},s.id)),C&&e.jsx("div",{className:"flex justify-start",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{className:"w-8 h-8",children:e.jsx(b,{className:"bg-gray-500 text-white",children:"A"})}),e.jsx("div",{className:"bg-gray-100 rounded-lg p-3",children:e.jsxs("div",{className:"flex space-x-1",children:[e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce"}),e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]})})]})}),e.jsx("div",{ref:j})]}),a.status!=="closed"&&e.jsx("div",{className:"border-t p-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(E,{value:o,onChange:s=>N(s.target.value),onKeyPress:T,placeholder:"Digite sua mensagem...",className:"flex-1",disabled:a.status==="closed"}),e.jsx(l,{type:"submit",size:"icon",className:"bg-arca-main hover:bg-arca-dark",disabled:!o.trim()||a.status==="closed",children:e.jsx(B,{className:"w-4 h-4"})})]})})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center py-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-4",children:"Chat ao Vivo - Suporte Técnico"}),e.jsx("p",{className:"text-lg text-gray-600 max-w-2xl mx-auto",children:"Fale diretamente com nossa equipe de suporte especializada. Estamos aqui para ajudar você a aproveitar ao máximo a plataforma Arca Insights."})]}),e.jsxs(h,{className:"border-2",children:[e.jsxs(p,{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-3 mb-4",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${m?"bg-green-500":"bg-red-500"} animate-pulse`}),e.jsx(O,{variant:m?"default":"secondary",className:"text-sm",children:m?"ONLINE":"OFFLINE"})]}),e.jsx(f,{className:"text-2xl",children:m?"Suporte Disponível":"Suporte Indisponível"}),e.jsxs(_,{children:[v.agentsOnline," agente(s) online • Resposta média: ",v.averageResponseTime]})]}),e.jsxs(g,{className:"text-center space-y-6",children:[e.jsxs(l,{onClick:I,size:"lg",className:"h-16 text-lg bg-arca-main hover:bg-arca-dark text-white w-full max-w-md",children:[e.jsx(k,{className:"w-6 h-6 mr-3"}),"Iniciar Chat ao Vivo"]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 max-w-md mx-auto",children:[e.jsxs(l,{variant:"outline",className:"h-12",onClick:()=>window.location.href="mailto:suporte@arcainsights.com",children:[e.jsx(R,{className:"w-4 h-4 mr-2"}),"E-mail"]}),e.jsxs(l,{variant:"outline",className:"h-12",onClick:()=>{const s="5521999999999",t=encodeURIComponent("Olá! Preciso de ajuda com a plataforma Arca Insights.");window.open(`https://wa.me/${s}?text=${t}`,"_blank")},children:[e.jsx(L,{className:"w-4 h-4 mr-2"}),"WhatsApp"]})]})]})]}),e.jsxs(h,{children:[e.jsx(p,{children:e.jsxs(f,{className:"flex items-center gap-2",children:[e.jsx(F,{className:"w-5 h-5"}),"Horários de Atendimento"]})}),e.jsx(g,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-gray-100",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Segunda a Sexta"}),e.jsx("span",{className:"text-gray-600",children:"8:00 - 18:00"})]}),e.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-gray-100",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Sábados"}),e.jsx("span",{className:"text-gray-600",children:"9:00 - 13:00"})]}),e.jsxs("div",{className:"flex justify-between items-center py-2",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Domingos"}),e.jsx("span",{className:"text-gray-600",children:"Fechado"})]})]})})]})]})})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-blue-50 p-4 flex items-center justify-center",children:e.jsxs(h,{className:"w-full max-w-md",children:[e.jsxs(p,{className:"text-center",children:[e.jsx(z,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),e.jsx(f,{children:"Acesso Necessário"})]}),e.jsxs(g,{className:"text-center",children:[e.jsx("p",{className:"text-gray-600 mb-4",children:"Você precisa estar logado para usar o chat ao vivo."}),e.jsx(l,{onClick:()=>window.location.href="/login",children:"Fazer Login"})]})]})})};export{te as default};
