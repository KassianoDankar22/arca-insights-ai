import{j as e}from"./supabase-vendor-vwXl956e.js";import{r as c}from"./react-vendor-DZvRB87w.js";import{v as g,U as V,B as p,C as j,d as x,a as $,b as k,y as f,z as N,e as d}from"./index-Df_bSpit.js";import{I as D}from"./input-BaSgXdNs.js";import{C as B}from"./clock-CpRAHura.js";import{C as U}from"./circle-alert-DJmbmDrI.js";import{C as J}from"./circle-Ldu75Sri.js";import{m as q}from"./proxy-CqlErGxY.js";import{S as H}from"./search-BHIbFhxn.js";import{U as v}from"./user-Ddd9JpRl.js";import{P as K}from"./phone-jarddx7C.js";import{V as F}from"./video-CeS_uorB.js";import{E as G}from"./ellipsis-vertical-DX30H_X1.js";import{P as Q,S as W}from"./smile-Dh69prsY.js";import{S as X}from"./send-GbuuznKv.js";import"./ui-vendor-Dea2Gxwc.js";const ue=()=>{const[a,y]=c.useState(null),[m,w]=c.useState(""),[h,M]=c.useState(""),[o,b]=c.useState([]),u=c.useRef(null);c.useEffect(()=>{const s=()=>{const r=localStorage.getItem("admin_live_chats");if(r){const i=JSON.parse(r).map(n=>({...n,startedAt:new Date(n.startedAt),lastActivity:new Date(n.lastActivity),messages:n.messages.map(I=>({...I,timestamp:new Date(I.timestamp)}))}));b(i)}};s();const t=setInterval(s,5e3);return()=>clearInterval(t)},[]);const C=o.filter(s=>s.userName.toLowerCase().includes(h.toLowerCase())||s.userEmail.toLowerCase().includes(h.toLowerCase())),S=s=>{switch(s){case"waiting":return"bg-yellow-500";case"active":return"bg-green-500";case"closed":return"bg-gray-500";default:return"bg-gray-500"}},T=s=>{switch(s){case"waiting":return"Aguardando";case"active":return"Ativo";case"closed":return"Encerrado";default:return"Desconhecido"}},_=s=>s.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"}),L=s=>{const r=new Date().getTime()-s.getTime(),l=Math.floor(r/(1e3*60));if(l<1)return"agora";if(l<60)return`${l}m atrás`;const i=Math.floor(l/60);return i<24?`${i}h atrás`:`${Math.floor(i/24)}d atrás`},A=()=>{if(!m.trim()||!a)return;const s={id:`msg_${Date.now()}`,senderId:"admin",senderName:"Suporte Arca",senderType:"admin",message:m.trim(),timestamp:new Date,read:!0},t={...a,messages:[...a.messages,s],status:"active",lastActivity:new Date},r=JSON.parse(localStorage.getItem("admin_live_chats")||"[]"),l=r.findIndex(i=>i.id===a.id);l>=0&&(r[l]=t,localStorage.setItem("admin_live_chats",JSON.stringify(r)),localStorage.setItem(`chat_session_${a.userId}`,JSON.stringify(t))),y(t),b(i=>i.map(n=>n.id===a.id?t:n)),w("")},z=s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),A())};c.useEffect(()=>{u.current&&u.current.scrollIntoView({behavior:"smooth"})},[a==null?void 0:a.messages]);const E=s=>s.messages.filter(t=>t.senderType==="user"&&!t.read).length,O=o.filter(s=>s.status!=="closed"),P=o.filter(s=>s.status==="waiting"),R=[{title:"Chats Ativos",value:O.length,icon:g,color:"blue"},{title:"Aguardando Resposta",value:P.length,icon:B,color:"yellow"},{title:"Total Hoje",value:o.length,icon:V,color:"green"},{title:"Mensagens não Lidas",value:o.reduce((s,t)=>s+E(t),0),icon:U,color:"red"}];return e.jsxs("div",{className:"p-6 max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Chat ao Vivo - Admin"}),e.jsx("p",{className:"text-gray-600",children:"Atenda usuários em tempo real"})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs(p,{variant:"outline",className:"px-3 py-1",children:[e.jsx(J,{className:"w-2 h-2 fill-green-500 text-green-500 mr-2"}),"Online"]})})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:R.map((s,t)=>e.jsx(q.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:t*.1},children:e.jsx(j,{children:e.jsx(x,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:s.title}),e.jsx("p",{className:"text-2xl font-bold",children:s.value})]}),e.jsx(s.icon,{className:`w-8 h-8 text-${s.color}-500`})]})})})},s.title))}),e.jsxs("div",{className:"grid grid-cols-12 gap-6 h-[600px]",children:[e.jsx("div",{className:"col-span-4",children:e.jsxs(j,{className:"h-full",children:[e.jsxs($,{className:"pb-3",children:[e.jsx(k,{className:"text-lg",children:"Sessões de Chat"}),e.jsxs("div",{className:"relative",children:[e.jsx(H,{className:"absolute left-3 top-3 w-4 h-4 text-gray-400"}),e.jsx(D,{placeholder:"Buscar usuários...",value:h,onChange:s=>M(s.target.value),className:"pl-10"})]})]}),e.jsx(x,{className:"p-0",children:e.jsx("div",{className:"overflow-y-auto h-[calc(600px-140px)]",children:C.length===0?e.jsxs("div",{className:"p-4 text-center text-gray-500",children:[e.jsx(g,{className:"w-12 h-12 mx-auto mb-2 text-gray-300"}),e.jsx("p",{children:"Nenhum chat disponível"}),e.jsx("p",{className:"text-sm",children:"Os chats aparecerão aqui quando os usuários iniciarem conversas"})]}):C.sort((s,t)=>t.lastActivity.getTime()-s.lastActivity.getTime()).map(s=>{const t=E(s),r=s.messages[s.messages.length-1];return e.jsx("div",{className:`p-4 border-b border-gray-100 cursor-pointer hover:bg-gray-50 transition-colors ${(a==null?void 0:a.id)===s.id?"bg-blue-50 border-blue-200":""}`,onClick:()=>y(s),children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx(f,{className:"w-10 h-10",children:e.jsx(N,{className:"bg-blue-500 text-white",children:e.jsx(v,{className:"w-5 h-5"})})}),e.jsx("div",{className:`absolute -bottom-1 -right-1 w-3 h-3 rounded-full border-2 border-white ${S(s.status)}`})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"font-medium text-gray-900 truncate",children:s.userName}),e.jsxs("div",{className:"flex items-center gap-1",children:[t>0&&e.jsx(p,{variant:"destructive",className:"px-1.5 py-0.5 text-xs",children:t}),e.jsx("span",{className:"text-xs text-gray-500",children:L(s.lastActivity)})]})]}),e.jsx("p",{className:"text-sm text-gray-500 truncate",children:s.userEmail}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(p,{variant:"outline",className:"px-1.5 py-0.5 text-xs",children:T(s.status)}),r&&e.jsxs("p",{className:"text-xs text-gray-400 truncate flex-1",children:[r.senderType==="admin"?"Você: ":"",r.message]})]})]})]})},s.id)})})})]})}),e.jsx("div",{className:"col-span-8",children:e.jsx(j,{className:"h-full",children:a?e.jsxs(e.Fragment,{children:[e.jsx($,{className:"border-b",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(f,{className:"w-10 h-10",children:e.jsx(N,{className:"bg-blue-500 text-white",children:e.jsx(v,{className:"w-5 h-5"})})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:a.userName}),e.jsx("p",{className:"text-sm text-gray-500",children:a.userEmail}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${S(a.status)}`}),e.jsx("span",{className:"text-xs text-gray-500",children:T(a.status)})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(d,{variant:"ghost",size:"sm",children:e.jsx(K,{className:"w-4 h-4"})}),e.jsx(d,{variant:"ghost",size:"sm",children:e.jsx(F,{className:"w-4 h-4"})}),e.jsx(d,{variant:"ghost",size:"sm",children:e.jsx(G,{className:"w-4 h-4"})})]})]})}),e.jsxs(x,{className:"p-0 flex flex-col h-[calc(600px-120px)]",children:[e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[a.messages.map(s=>e.jsx("div",{className:`flex ${s.senderType==="admin"?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`flex items-start gap-2 max-w-[70%] ${s.senderType==="admin"?"flex-row-reverse":""}`,children:[e.jsx(f,{className:"w-8 h-8",children:e.jsx(N,{className:s.senderType==="admin"?"bg-green-500 text-white":"bg-blue-500 text-white",children:s.senderType==="admin"?"A":e.jsx(v,{className:"w-4 h-4"})})}),e.jsxs("div",{className:`rounded-lg p-3 ${s.senderType==="admin"?"bg-green-500 text-white":"bg-gray-100 text-gray-900"}`,children:[e.jsx("p",{className:"text-sm",children:s.message}),e.jsx("p",{className:`text-xs mt-1 ${s.senderType==="admin"?"text-green-100":"text-gray-500"}`,children:_(s.timestamp)})]})]})},s.id)),e.jsx("div",{ref:u})]}),a.status!=="closed"&&e.jsx("div",{className:"border-t p-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(d,{variant:"ghost",size:"sm",className:"px-2",children:e.jsx(Q,{className:"w-4 h-4"})}),e.jsx(d,{variant:"ghost",size:"sm",className:"px-2",children:e.jsx(W,{className:"w-4 h-4"})}),e.jsx(D,{value:m,onChange:s=>w(s.target.value),onKeyPress:z,placeholder:"Digite sua mensagem...",className:"flex-1"}),e.jsx(d,{onClick:A,disabled:!m.trim(),className:"bg-green-500 hover:bg-green-600",children:e.jsx(X,{className:"w-4 h-4"})})]})})]})]}):e.jsx(x,{className:"h-full flex items-center justify-center",children:e.jsxs("div",{className:"text-center text-gray-500",children:[e.jsx(g,{className:"w-16 h-16 mx-auto mb-4 text-gray-300"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"Selecione um chat"}),e.jsx("p",{children:"Escolha uma conversa na lista para começar a responder"})]})})})})]})]})};export{ue as default};
