import{j as e}from"./supabase-vendor-vwXl956e.js";import{r as d,i as fe,e as he}from"./react-vendor-DZvRB87w.js";import{j as xe,e as k,A as ge}from"./index-Df_bSpit.js";import{P as pe}from"./progress-UGcfPXjE.js";import{a as W}from"./academyService-ad8ssUf2.js";import{c as J,u as ve}from"./index-v7iOeiPF.js";import{d as be,c as we,l as Se,e as I,P as K,b as A,m as je,f as ye}from"./ui-vendor-Dea2Gxwc.js";import{P as Ne,S as Ce,b as Pe,c as Re,V as Ee,a as Me,M as ke}from"./volume-x-43ZUBhaA.js";import{P as De}from"./play-zhtG0YHf.js";import{u as Ve}from"./useCourse-Bu3ayPPi.js";import{L as _e}from"./loader-circle-Dnz5ZzbO.js";import{B as q}from"./book-open-D-0VQ5P1.js";import{C as Te}from"./chevron-up-BR0CPyY0.js";import{C as Ie}from"./chevron-down-Bc7oyTHl.js";import{C as Ae}from"./circle-check-big-BbmS712-.js";var Q=["PageUp","PageDown"],Z=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],ee={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},B="Slider",[H,Be,Le]=Se(B),[te,pt]=we(B,[Le]),[Ke,z]=te(B),se=d.forwardRef((s,r)=>{const{name:n,min:t=0,max:c=100,step:m=1,orientation:a="horizontal",disabled:o=!1,minStepsBetweenThumbs:h=0,defaultValue:f=[t],value:b,onValueChange:l=()=>{},onValueCommit:g=()=>{},inverted:j=!1,form:y,...S}=s,w=d.useRef(new Set),i=d.useRef(0),p=a==="horizontal"?ze:Fe,[v=[],P]=be({prop:b,defaultProp:f,onChange:N=>{var _;(_=[...w.current][i.current])==null||_.focus(),l(N)}}),D=d.useRef(v);function u(N){const E=Ye(v,N);R(N,E)}function C(N){R(N,i.current)}function V(){const N=D.current[i.current];v[i.current]!==N&&g(v)}function R(N,E,{commit:_}={commit:!1}){const X=qe(m),F=Je(Math.round((N-t)/m)*m+t,X),L=J(F,[t,c]);P((T=[])=>{const M=Ue(T,L,E);if(We(M,h*m)){i.current=M.indexOf(L);const G=String(M)!==String(T);return G&&_&&g(M),G?M:T}else return T})}return e.jsx(Ke,{scope:s.__scopeSlider,name:n,disabled:o,min:t,max:c,valueIndexToChangeRef:i,thumbs:w.current,values:v,orientation:a,form:y,children:e.jsx(H.Provider,{scope:s.__scopeSlider,children:e.jsx(H.Slot,{scope:s.__scopeSlider,children:e.jsx(p,{"aria-disabled":o,"data-disabled":o?"":void 0,...S,ref:r,onPointerDown:I(S.onPointerDown,()=>{o||(D.current=v)}),min:t,max:c,inverted:j,onSlideStart:o?void 0:u,onSlideMove:o?void 0:C,onSlideEnd:o?void 0:V,onHomeKeyDown:()=>!o&&R(t,0,{commit:!0}),onEndKeyDown:()=>!o&&R(c,v.length-1,{commit:!0}),onStepKeyDown:({event:N,direction:E})=>{if(!o){const F=Q.includes(N.key)||N.shiftKey&&Z.includes(N.key)?10:1,L=i.current,T=v[L],M=m*F*E;R(T+M,L,{commit:!0})}}})})})})});se.displayName=B;var[re,ne]=te(B,{startEdge:"left",endEdge:"right",size:"width",direction:1}),ze=d.forwardRef((s,r)=>{const{min:n,max:t,dir:c,inverted:m,onSlideStart:a,onSlideMove:o,onSlideEnd:h,onStepKeyDown:f,...b}=s,[l,g]=d.useState(null),j=A(r,p=>g(p)),y=d.useRef(void 0),S=je(c),w=S==="ltr",i=w&&!m||!w&&m;function x(p){const v=y.current||l.getBoundingClientRect(),P=[0,v.width],u=Y(P,i?[n,t]:[t,n]);return y.current=v,u(p-v.left)}return e.jsx(re,{scope:s.__scopeSlider,startEdge:i?"left":"right",endEdge:i?"right":"left",direction:i?1:-1,size:"width",children:e.jsx(ae,{dir:S,"data-orientation":"horizontal",...b,ref:j,style:{...b.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:p=>{const v=x(p.clientX);a==null||a(v)},onSlideMove:p=>{const v=x(p.clientX);o==null||o(v)},onSlideEnd:()=>{y.current=void 0,h==null||h()},onStepKeyDown:p=>{const P=ee[i?"from-left":"from-right"].includes(p.key);f==null||f({event:p,direction:P?-1:1})}})})}),Fe=d.forwardRef((s,r)=>{const{min:n,max:t,inverted:c,onSlideStart:m,onSlideMove:a,onSlideEnd:o,onStepKeyDown:h,...f}=s,b=d.useRef(null),l=A(r,b),g=d.useRef(void 0),j=!c;function y(S){const w=g.current||b.current.getBoundingClientRect(),i=[0,w.height],p=Y(i,j?[t,n]:[n,t]);return g.current=w,p(S-w.top)}return e.jsx(re,{scope:s.__scopeSlider,startEdge:j?"bottom":"top",endEdge:j?"top":"bottom",size:"height",direction:j?1:-1,children:e.jsx(ae,{"data-orientation":"vertical",...f,ref:l,style:{...f.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:S=>{const w=y(S.clientY);m==null||m(w)},onSlideMove:S=>{const w=y(S.clientY);a==null||a(w)},onSlideEnd:()=>{g.current=void 0,o==null||o()},onStepKeyDown:S=>{const i=ee[j?"from-bottom":"from-top"].includes(S.key);h==null||h({event:S,direction:i?-1:1})}})})}),ae=d.forwardRef((s,r)=>{const{__scopeSlider:n,onSlideStart:t,onSlideMove:c,onSlideEnd:m,onHomeKeyDown:a,onEndKeyDown:o,onStepKeyDown:h,...f}=s,b=z(B,n);return e.jsx(K.span,{...f,ref:r,onKeyDown:I(s.onKeyDown,l=>{l.key==="Home"?(a(l),l.preventDefault()):l.key==="End"?(o(l),l.preventDefault()):Q.concat(Z).includes(l.key)&&(h(l),l.preventDefault())}),onPointerDown:I(s.onPointerDown,l=>{const g=l.target;g.setPointerCapture(l.pointerId),l.preventDefault(),b.thumbs.has(g)?g.focus():t(l)}),onPointerMove:I(s.onPointerMove,l=>{l.target.hasPointerCapture(l.pointerId)&&c(l)}),onPointerUp:I(s.onPointerUp,l=>{const g=l.target;g.hasPointerCapture(l.pointerId)&&(g.releasePointerCapture(l.pointerId),m(l))})})}),oe="SliderTrack",ie=d.forwardRef((s,r)=>{const{__scopeSlider:n,...t}=s,c=z(oe,n);return e.jsx(K.span,{"data-disabled":c.disabled?"":void 0,"data-orientation":c.orientation,...t,ref:r})});ie.displayName=oe;var O="SliderRange",le=d.forwardRef((s,r)=>{const{__scopeSlider:n,...t}=s,c=z(O,n),m=ne(O,n),a=d.useRef(null),o=A(r,a),h=c.values.length,f=c.values.map(g=>ue(g,c.min,c.max)),b=h>1?Math.min(...f):0,l=100-Math.max(...f);return e.jsx(K.span,{"data-orientation":c.orientation,"data-disabled":c.disabled?"":void 0,...t,ref:o,style:{...s.style,[m.startEdge]:b+"%",[m.endEdge]:l+"%"}})});le.displayName=O;var U="SliderThumb",ce=d.forwardRef((s,r)=>{const n=Be(s.__scopeSlider),[t,c]=d.useState(null),m=A(r,o=>c(o)),a=d.useMemo(()=>t?n().findIndex(o=>o.ref.current===t):-1,[n,t]);return e.jsx(He,{...s,ref:m,index:a})}),He=d.forwardRef((s,r)=>{const{__scopeSlider:n,index:t,name:c,...m}=s,a=z(U,n),o=ne(U,n),[h,f]=d.useState(null),b=A(r,x=>f(x)),l=h?a.form||!!h.closest("form"):!0,g=ye(h),j=a.values[t],y=j===void 0?0:ue(j,a.min,a.max),S=$e(t,a.values.length),w=g==null?void 0:g[o.size],i=w?Xe(w,y,o.direction):0;return d.useEffect(()=>{if(h)return a.thumbs.add(h),()=>{a.thumbs.delete(h)}},[h,a.thumbs]),e.jsxs("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[o.startEdge]:`calc(${y}% + ${i}px)`},children:[e.jsx(H.ItemSlot,{scope:s.__scopeSlider,children:e.jsx(K.span,{role:"slider","aria-label":s["aria-label"]||S,"aria-valuemin":a.min,"aria-valuenow":j,"aria-valuemax":a.max,"aria-orientation":a.orientation,"data-orientation":a.orientation,"data-disabled":a.disabled?"":void 0,tabIndex:a.disabled?void 0:0,...m,ref:b,style:j===void 0?{display:"none"}:s.style,onFocus:I(s.onFocus,()=>{a.valueIndexToChangeRef.current=t})})}),l&&e.jsx(de,{name:c??(a.name?a.name+(a.values.length>1?"[]":""):void 0),form:a.form,value:j},t)]})});ce.displayName=U;var Oe="RadioBubbleInput",de=d.forwardRef(({__scopeSlider:s,value:r,...n},t)=>{const c=d.useRef(null),m=A(c,t),a=ve(r);return d.useEffect(()=>{const o=c.current;if(!o)return;const h=window.HTMLInputElement.prototype,b=Object.getOwnPropertyDescriptor(h,"value").set;if(a!==r&&b){const l=new Event("input",{bubbles:!0});b.call(o,r),o.dispatchEvent(l)}},[a,r]),e.jsx(K.input,{style:{display:"none"},...n,ref:m,defaultValue:r})});de.displayName=Oe;function Ue(s=[],r,n){const t=[...s];return t[n]=r,t.sort((c,m)=>c-m)}function ue(s,r,n){const m=100/(n-r)*(s-r);return J(m,[0,100])}function $e(s,r){return r>2?`Value ${s+1} of ${r}`:r===2?["Minimum","Maximum"][s]:void 0}function Ye(s,r){if(s.length===1)return 0;const n=s.map(c=>Math.abs(c-r)),t=Math.min(...n);return n.indexOf(t)}function Xe(s,r,n){const t=s/2,m=Y([0,50],[0,t]);return(t-m(r)*n)*n}function Ge(s){return s.slice(0,-1).map((r,n)=>s[n+1]-r)}function We(s,r){if(r>0){const n=Ge(s);return Math.min(...n)>=r}return!0}function Y(s,r){return n=>{if(s[0]===s[1]||r[0]===r[1])return r[0];const t=(r[1]-r[0])/(s[1]-s[0]);return r[0]+t*(n-s[0])}}function qe(s){return(String(s).split(".")[1]||"").length}function Je(s,r){const n=Math.pow(10,r);return Math.round(s*n)/n}var me=se,Qe=ie,Ze=le,et=ce;const $=d.forwardRef(({className:s,...r},n)=>e.jsxs(me,{ref:n,className:xe("relative flex w-full touch-none select-none items-center",s),...r,children:[e.jsx(Qe,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary",children:e.jsx(Ze,{className:"absolute h-full bg-primary"})}),e.jsx(et,{className:"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]}));$.displayName=me.displayName;const tt=({videoUrl:s,onProgress:r,onComplete:n})=>{const t=d.useRef(null),[c,m]=d.useState(!1),[a,o]=d.useState(0),[h,f]=d.useState(0),[b,l]=d.useState(1),[g,j]=d.useState(!1),[y,S]=d.useState(!1);d.useEffect(()=>{const u=t.current;if(!u)return;const C=()=>{o(u.currentTime);const R=u.currentTime/u.duration*100;r==null||r(R),R>=100&&(n==null||n())},V=()=>{f(u.duration)};return u.addEventListener("timeupdate",C),u.addEventListener("loadedmetadata",V),()=>{u.removeEventListener("timeupdate",C),u.removeEventListener("loadedmetadata",V)}},[r,n]);const w=()=>{t.current&&(c?t.current.pause():t.current.play(),m(!c))},i=u=>{t.current&&(t.current.volume=u,l(u),j(u===0))},x=()=>{if(t.current){const u=!g;t.current.muted=u,j(u),u?l(0):(l(1),t.current.volume=1)}},p=()=>{var u;document.fullscreenElement?(document.exitFullscreen(),S(!1)):((u=t.current)==null||u.requestFullscreen(),S(!0))},v=u=>{if(t.current){const C=u/100*h;t.current.currentTime=C,o(C)}},P=u=>{const C=Math.floor(u/60),V=Math.floor(u%60);return`${C}:${V.toString().padStart(2,"0")}`},D=u=>{t.current&&(t.current.currentTime+=u)};return e.jsxs("div",{className:"relative group",children:[e.jsx("video",{ref:t,src:s,className:"w-full rounded-lg",onClick:w}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/80 to-transparent p-4 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx($,{value:[a/h*100],onValueChange:u=>v(u[0]),max:100,step:.1,className:"w-full"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{size:"sm",variant:"ghost",className:"text-white hover:bg-white/20",onClick:w,children:c?e.jsx(Ne,{className:"w-4 h-4"}):e.jsx(De,{className:"w-4 h-4"})}),e.jsx(k,{size:"sm",variant:"ghost",className:"text-white hover:bg-white/20",onClick:()=>D(-10),children:e.jsx(Ce,{className:"w-4 h-4"})}),e.jsx(k,{size:"sm",variant:"ghost",className:"text-white hover:bg-white/20",onClick:()=>D(10),children:e.jsx(Pe,{className:"w-4 h-4"})}),e.jsxs("span",{className:"text-white text-sm",children:[P(a)," / ",P(h)]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{size:"sm",variant:"ghost",className:"text-white hover:bg-white/20",onClick:x,children:g?e.jsx(Re,{className:"w-4 h-4"}):e.jsx(Ee,{className:"w-4 h-4"})}),e.jsx($,{value:[b*100],onValueChange:u=>i(u[0]/100),max:100,className:"w-24"})]}),e.jsx(k,{size:"sm",variant:"ghost",className:"text-white hover:bg-white/20",onClick:p,children:y?e.jsx(Me,{className:"w-4 h-4"}):e.jsx(ke,{className:"w-4 h-4"})})]})]})]})})]})},vt=()=>{const{courseId:s}=fe(),r=he(),{course:n,modules:t,progress:c,loading:m,error:a}=Ve(s),[o,h]=d.useState(null),[f,b]=d.useState(null),[l,g]=d.useState([]);d.useEffect(()=>{t.length>0&&(h(t[0]),t[0].lessons.length>0&&b(t[0].lessons[0]),g([t[0].id]))},[t]);const j=i=>{g(x=>x.includes(i)?x.filter(p=>p!==i):[...x,i])},y=(i,x)=>{h(i),b(x)},S=async i=>{if(f)try{if(await W.updateLessonProgress(f.id,i,i===100),setModules(x=>x.map(p=>({...p,lessons:p.lessons.map(v=>v.id===f.id?{...v,progress:i,completed:i===100}:v)}))),s){const x=await W.getCourseProgress(s);setProgress(x)}}catch(x){console.error("Failed to update progress:",x)}},w=async()=>{if(f&&o){const i=t.findIndex(p=>p.id===o.id),x=o.lessons.findIndex(p=>p.id===f.id);if(x<o.lessons.length-1)b(o.lessons[x+1]);else if(i<t.length-1){const p=t[i+1];h(p),b(p.lessons[0]),g(v=>[...v,p.id])}}};return m?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-black text-white flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(_e,{className:"w-12 h-12 animate-spin text-blue-500 mx-auto mb-4"}),e.jsx("p",{className:"text-lg text-gray-300",children:"Carregando aula..."})]})}):a||!n?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-black text-white flex items-center justify-center",children:e.jsxs("div",{className:"text-center max-w-md mx-auto px-4",children:[e.jsx(q,{className:"w-16 h-16 text-red-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"Ops! Algo deu errado."}),e.jsx("p",{className:"text-gray-300 mb-4",children:(a==null?void 0:a.message)||"Curso não encontrado"}),e.jsx(k,{onClick:()=>r("/academy"),className:"bg-blue-600 hover:bg-blue-700",children:"Voltar para Academy"})]})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-black text-white",children:e.jsxs("div",{className:"flex h-screen",children:[e.jsx("div",{className:"w-80 bg-gray-800 border-r border-gray-700 overflow-y-auto",children:e.jsxs("div",{className:"p-4",children:[e.jsxs(k,{variant:"ghost",className:"mb-4 text-white hover:text-blue-400",onClick:()=>r(`/academy/${s}`),children:[e.jsx(ge,{className:"w-5 h-5 mr-2"}),"Voltar para o curso"]}),e.jsx("h2",{className:"text-xl font-bold mb-2",children:n==null?void 0:n.title}),e.jsx(pe,{value:c,className:"mb-4"}),e.jsxs("p",{className:"text-sm text-gray-400 mb-6",children:[Math.round(c),"% completo"]}),e.jsx("div",{className:"space-y-2",children:t.map(i=>e.jsxs("div",{className:"border border-gray-700 rounded-lg",children:[e.jsxs("button",{className:"w-full p-3 flex items-center justify-between text-left hover:bg-gray-700/50",onClick:()=>j(i.id),children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:i.title}),e.jsx("p",{className:"text-sm text-gray-400",children:i.duration})]}),l.includes(i.id)?e.jsx(Te,{className:"w-5 h-5"}):e.jsx(Ie,{className:"w-5 h-5"})]}),l.includes(i.id)&&e.jsx("div",{className:"border-t border-gray-700",children:i.lessons.map(x=>e.jsxs("button",{className:`w-full p-3 flex items-center gap-2 text-left hover:bg-gray-700/50 ${(f==null?void 0:f.id)===x.id?"bg-blue-600/20":""}`,onClick:()=>y(i,x),children:[x.completed?e.jsx(Ae,{className:"w-5 h-5 text-green-500 flex-shrink-0"}):e.jsx("div",{className:"w-5 h-5 border-2 border-gray-500 rounded-full flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:x.title}),e.jsx("p",{className:"text-sm text-gray-400",children:x.duration})]})]},x.id))})]},i.id))})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:f?e.jsxs("div",{className:"p-6",children:[e.jsx(tt,{videoUrl:f.videoUrl,onProgress:S,onComplete:w}),e.jsxs("div",{className:"mt-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:f.title}),e.jsx("p",{className:"text-gray-400",children:o==null?void 0:o.title}),f.description&&e.jsx("p",{className:"mt-4 text-gray-300",children:f.description})]})]}):e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center",children:[e.jsx(q,{className:"w-16 h-16 text-gray-500 mx-auto mb-4"}),e.jsx("p",{className:"text-xl text-gray-300",children:"Selecione uma aula para começar"})]})})})]})})};export{vt as default};
