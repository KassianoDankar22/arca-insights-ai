import{r as s}from"./react-vendor-DZvRB87w.js";import{s as t}from"./index-Bcg3-yyF.js";function q(){const[v,u]=s.useState(null),[c,o]=s.useState(null),[y,f]=s.useState(!0);s.useEffect(()=>{t.auth.getSession().then(({data:{session:a}})=>{u(a),a!=null&&a.user?p(a.user):o(null),f(!1)});const{data:{subscription:r}}=t.auth.onAuthStateChange(async(a,e)=>{u(e),e!=null&&e.user?await p(e.user):o(null),f(!1)});return()=>r.unsubscribe()},[]);const p=async r=>{var a,e,n,l,g,_;try{const{data:i,error:d}=await t.from("usuarios").select("*").eq("id",r.id).single();if(d&&d.code!=="PGRST116"&&console.error("Erro ao carregar perfil:",d),i)o({id:r.id,email:r.email,name:i.nome_completo,avatar_url:i.avatar_url,plan:"free",status:"active"});else{const m={id:r.id,email:r.email||"",nome_completo:((a=r.user_metadata)==null?void 0:a.full_name)||((e=r.user_metadata)==null?void 0:e.name)||"",avatar_url:((n=r.user_metadata)==null?void 0:n.avatar_url)||null,criado_em:new Date().toISOString(),atualizado_em:new Date().toISOString()},{error:w}=await t.from("usuarios").insert([m]);w&&console.error("Erro ao criar perfil:",w),o({id:r.id,email:r.email,name:m.nome_completo,avatar_url:m.avatar_url,plan:"free",status:"active"})}}catch(i){console.error("Erro ao carregar perfil do usuário:",i),o({id:r.id,email:r.email,name:((l=r.user_metadata)==null?void 0:l.full_name)||((g=r.user_metadata)==null?void 0:g.name),avatar_url:(_=r.user_metadata)==null?void 0:_.avatar_url,plan:"free",status:"active"})}};return{user:c,session:v,loading:y,signIn:async(r,a)=>{const{data:e,error:n}=await t.auth.signInWithPassword({email:r,password:a});return{data:e,error:n}},signUp:async(r,a,e)=>{const{data:n,error:l}=await t.auth.signUp({email:r,password:a,options:{data:{full_name:e}}});return{data:n,error:l}},signInWithGoogle:async()=>{const{data:r,error:a}=await t.auth.signInWithOAuth({provider:"google",options:{redirectTo:`${window.location.origin}/dashboard`,queryParams:{access_type:"offline",prompt:"consent"}}});return{data:r,error:a}},signOut:async()=>{const{error:r}=await t.auth.signOut();return r||(o(null),u(null)),{error:r}},resetPassword:async r=>{const{data:a,error:e}=await t.auth.resetPasswordForEmail(r,{redirectTo:`${window.location.origin}/reset-password`});return{data:a,error:e}},updateProfile:async r=>{if(!c)return{error:new Error("Usuário não autenticado")};try{const{error:a}=await t.from("usuarios").update({nome_completo:r.name,avatar_url:r.avatar_url}).eq("id",c.id);if(a)throw a;return o(e=>e?{...e,...r}:null),{error:null}}catch(a){return console.error("Erro ao atualizar perfil:",a),{error:a}}}}}export{q as u};
