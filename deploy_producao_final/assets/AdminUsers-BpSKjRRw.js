import{j as e}from"./supabase-vendor-vwXl956e.js";import{r as f}from"./react-vendor-DZvRB87w.js";import{U as B,x as E,g as v,D as L,e as w,C as q,a as we,b as Ne,d as M,y as ye,K as be,z as Ce,B as _,t}from"./index-Df_bSpit.js";import{I as Se}from"./input-BaSgXdNs.js";import{T as Te,a as $e,b as U,c as P}from"./tabs-CFPvKsOc.js";import{T as Ue,a as Pe,b as I,c as i,d as Fe,e as c}from"./table-CfxSGWBn.js";import{S as z,a as V,b as G,c as H,d}from"./select-DWYjgQBo.js";import{D as Re,a as ke,b as De,c as h,d as Ae}from"./dropdown-menu-DPYtsa-V.js";import{u as Be}from"./useRealData-BiNFJK86.js";import{T as N}from"./trending-up-D6UT933U.js";import{C as Ee}from"./credit-card-neFNjxig.js";import{L as Le}from"./loader-circle-Dnz5ZzbO.js";import{D as qe}from"./download-B09wcfGt.js";import{P as Me}from"./plus-Cf9uTjEE.js";import{S as _e}from"./search-BHIbFhxn.js";import{E as Ie}from"./ellipsis-DtsklKbr.js";import{S as K,B as ze}from"./square-pen-Cdnj2ybm.js";import{M as Ve}from"./mail-DzfX9Lve.js";import{C as Ge}from"./circle-check-big-BbmS712-.js";import{m as He}from"./proxy-CqlErGxY.js";import"./ui-vendor-Dea2Gxwc.js";import"./index-v7iOeiPF.js";import"./chevron-down-Bc7oyTHl.js";import"./check-Cr6J53Lh.js";import"./chevron-up-BR0CPyY0.js";import"./chevron-right-BDoRpBXC.js";import"./circle-Ldu75Sri.js";const wa=()=>{const[y,J]=f.useState(""),[b,O]=f.useState("all"),[C,Q]=f.useState("all"),[m,W]=f.useState("all"),{users:x,stats:p,loading:F,error:R,makeAdmin:X,promoteToPro:Y,toggleUserStatus:Z,exportUsers:ee,sendEmail:ae,resetUserPassword:se,refetch:S}=Be(),te=async(a,s)=>{if(confirm(`Você tem certeza que deseja tornar ${s} um administrador? Essa ação não pode ser desfeita facilmente.`))try{await X(a),t.success(`${s} agora é um administrador!`),S()}catch(l){t.error("Falha ao atualizar o usuário.",{description:l.message})}},re=async(a,s)=>{if(confirm(`Você tem certeza que deseja promover ${s} para o plano Pro?`))try{await Y(a),t.success(`${s} foi promovido para o plano Pro!`),S()}catch(l){t.error("Falha ao promover usuário.",{description:l.message})}},k=async(a,s,r)=>{const l=r==="active"?"bloquear":"ativar";if(confirm(`Você tem certeza que deseja ${l} ${s}?`))try{await Z(a),t.success(`${s} foi ${l==="bloquear"?"bloqueado":"ativado"} com sucesso!`),S()}catch(j){t.error(`Falha ao ${l} usuário.`,{description:j.message})}},le=()=>{try{ee(),t.success("Dados dos usuários exportados com sucesso!")}catch(a){t.error("Falha ao exportar dados.",{description:a.message})}},oe=async(a,s,r)=>{try{await ae(a,s),t.success(`Cliente de email aberto para ${r}`)}catch(l){t.error("Falha ao abrir cliente de email.",{description:l.message})}},ne=async(a,s)=>{const r=prompt(`Digite a nova senha para ${s} (mínimo 6 caracteres):`);if(r&&r.length>=6){if(confirm(`Você tem certeza que deseja resetar a senha de ${s}?`))try{await se(a,r),t.success(`Senha de ${s} foi resetada com sucesso!`)}catch(g){t.error("Falha ao resetar senha.",{description:g.message})}}else r!==null&&t.error("A senha deve ter pelo menos 6 caracteres")},ie=()=>{t.info("Funcionalidade de criação de usuário em desenvolvimento")},ce=(a,s)=>{t.info(`Edição de ${s} em desenvolvimento`)},T=(()=>{let a=x;return m==="free"?a=a.filter(s=>s.plan==="free"):m==="paid"&&(a=a.filter(s=>s.plan==="pro"||s.plan==="enterprise")),a.filter(s=>{var j;const r=((j=s.name)==null?void 0:j.toLowerCase().includes(y.toLowerCase()))||s.email.toLowerCase().includes(y.toLowerCase()),l=b==="all"||s.status===b,g=C==="all"||s.plan===C;return r&&l&&g})})(),o=x.filter(a=>a.plan==="free"),n=x.filter(a=>a.plan==="pro"||a.plan==="enterprise"),de=x.filter(a=>a.plan==="pro"),me=x.filter(a=>a.plan==="enterprise"),u=x.reduce((a,s)=>a+s.revenue,0),D=n.length>0?u/n.length:0,xe=[{title:"Total de Usuários",value:p.total.toString(),change:`+${p.newThisMonth} este mês`,trend:"up",icon:B,color:"blue"},{title:"Usuários Gratuitos",value:o.length.toString(),change:`${(o.length/p.total*100).toFixed(1)}% do total`,trend:"neutral",icon:E,color:"gray"},{title:"Usuários Pagos",value:n.length.toString(),change:`${(n.length/p.total*100).toFixed(1)}% do total`,trend:"up",icon:v,color:"yellow"},{title:"Receita Total",value:`R$ ${u.toLocaleString("pt-BR",{minimumFractionDigits:2})}`,change:`R$ ${D.toFixed(2)} por usuário pago`,trend:"up",icon:L,color:"green"}],he=[{title:"Usuários Gratuitos",value:o.length.toString(),change:`${(o.length/p.total*100).toFixed(1)}% do total`,trend:"neutral",icon:E,color:"gray"},{title:"Usuários Ativos",value:o.filter(a=>a.status==="active").length.toString(),change:`${(o.filter(a=>a.status==="active").length/o.length*100).toFixed(1)}% ativo`,trend:"up",icon:N,color:"green"},{title:"Total de Análises",value:o.reduce((a,s)=>a+s.total_analyses,0).toString(),change:`${(o.reduce((a,s)=>a+s.total_analyses,0)/o.length).toFixed(1)} por usuário`,trend:"neutral",icon:B,color:"blue"},{title:"Potencial de Conversão",value:o.filter(a=>a.total_analyses>=5).length.toString(),change:"usuários com 5+ análises",trend:"up",icon:v,color:"yellow"}],pe=[{title:"Usuários Pagos",value:n.length.toString(),change:`${de.length} Pro + ${me.length} Enterprise`,trend:"up",icon:v,color:"yellow"},{title:"Receita Total",value:`R$ ${u.toLocaleString("pt-BR",{minimumFractionDigits:2})}`,change:`R$ ${D.toFixed(2)} por usuário`,trend:"up",icon:L,color:"green"},{title:"Receita Mensal Recorrente",value:`R$ ${(u*.1).toLocaleString("pt-BR",{minimumFractionDigits:2})}`,change:"+12.5% vs mês anterior",trend:"up",icon:Ee,color:"green"},{title:"Análises Realizadas",value:n.reduce((a,s)=>a+s.total_analyses,0).toString(),change:`${(n.reduce((a,s)=>a+s.total_analyses,0)/n.length).toFixed(1)} por usuário`,trend:"up",icon:N,color:"blue"}],ue=a=>{const s={free:"bg-gray-100 text-gray-800",pro:"bg-blue-100 text-blue-800",enterprise:"bg-purple-100 text-purple-800"};return s[a]||s.free},ge=a=>{const s={active:"bg-green-100 text-green-800",inactive:"bg-yellow-100 text-yellow-800",blocked:"bg-red-100 text-red-800"};return s[a]||s.active},A=a=>new Date(a).toLocaleDateString("pt-BR"),je=a=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(a),fe=a=>({active:"Ativo",inactive:"Inativo",blocked:"Bloqueado"})[a]||a,ve=a=>({free:"Gratuito",pro:"Pro",enterprise:"Enterprise"})[a]||a,$=a=>e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:a.map((s,r)=>e.jsx(He.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:r*.1},children:e.jsx(q,{children:e.jsx(M,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:s.title}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:s.value}),e.jsxs("div",{className:"flex items-center mt-1",children:[e.jsx(N,{className:"w-4 h-4 text-green-500 mr-1"}),e.jsx("span",{className:"text-sm text-green-600 font-medium",children:s.change})]})]}),e.jsx("div",{className:`p-3 rounded-lg bg-${s.color}-100`,children:e.jsx(s.icon,{className:`w-6 h-6 text-${s.color}-600`})})]})})})},s.title))});return F?e.jsx("div",{className:"p-6 max-w-7xl mx-auto",children:e.jsxs("div",{className:"flex items-center justify-center h-64",children:[e.jsx(Le,{className:"w-8 h-8 animate-spin"}),e.jsx("span",{className:"ml-2",children:"Carregando usuários..."})]})}):R?e.jsx("div",{className:"p-6 max-w-7xl mx-auto",children:e.jsxs("div",{className:"text-center text-red-600",children:[e.jsx("p",{children:R}),e.jsx(w,{onClick:()=>window.location.reload(),className:"mt-4",children:"Tentar Novamente"})]})}):e.jsxs("div",{className:"p-6 max-w-7xl mx-auto space-y-8",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Gerenciar Usuários"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Gerencie contas de usuários, planos e atividades"})]}),e.jsxs("div",{className:"mt-4 lg:mt-0 flex items-center gap-3",children:[e.jsxs(w,{variant:"outline",onClick:le,children:[e.jsx(qe,{className:"w-4 h-4 mr-2"}),"Exportar"]}),e.jsxs(w,{variant:"arca",onClick:ie,children:[e.jsx(Me,{className:"w-4 h-4 mr-2"}),"Novo Usuário"]})]})]}),e.jsxs(Te,{value:m,onValueChange:W,className:"w-full",children:[e.jsxs($e,{className:"grid w-full grid-cols-3",children:[e.jsx(U,{value:"all",children:"Todos os Usuários"}),e.jsx(U,{value:"free",children:"Usuários Gratuitos"}),e.jsx(U,{value:"paid",children:"Usuários Pagos"})]}),e.jsx(P,{value:"all",className:"space-y-6",children:$(xe)}),e.jsx(P,{value:"free",className:"space-y-6",children:$(he)}),e.jsx(P,{value:"paid",className:"space-y-6",children:$(pe)})]}),e.jsxs(q,{children:[e.jsx(we,{children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs(Ne,{children:["Lista de Usuários (",T.length,m==="free"&&" gratuitos",m==="paid"&&" pagos",m==="all"&&" total",")"]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(_e,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx(Se,{placeholder:"Buscar usuários...",value:y,onChange:a=>J(a.target.value),className:"pl-10 w-64"})]}),e.jsxs(z,{value:b,onValueChange:O,children:[e.jsx(V,{className:"w-32",children:e.jsx(G,{placeholder:"Status"})}),e.jsxs(H,{children:[e.jsx(d,{value:"all",children:"Todos"}),e.jsx(d,{value:"active",children:"Ativo"}),e.jsx(d,{value:"inactive",children:"Inativo"}),e.jsx(d,{value:"blocked",children:"Bloqueado"})]})]}),m==="all"&&e.jsxs(z,{value:C,onValueChange:Q,children:[e.jsx(V,{className:"w-32",children:e.jsx(G,{placeholder:"Plano"})}),e.jsxs(H,{children:[e.jsx(d,{value:"all",children:"Todos"}),e.jsx(d,{value:"free",children:"Gratuito"}),e.jsx(d,{value:"pro",children:"Pro"}),e.jsx(d,{value:"enterprise",children:"Enterprise"})]})]})]})]})}),e.jsxs(M,{children:[e.jsx("div",{className:"rounded-md border",children:e.jsxs(Ue,{children:[e.jsx(Pe,{children:e.jsxs(I,{children:[e.jsx(i,{children:"Usuário"}),e.jsx(i,{children:"Plano"}),e.jsx(i,{children:"Status"}),e.jsx(i,{children:"Cadastro"}),e.jsx(i,{children:"Último Acesso"}),e.jsx(i,{children:"Análises"}),e.jsx(i,{children:"Receita"}),e.jsx(i,{className:"w-[70px]",children:"Ações"})]})}),e.jsx(Fe,{children:T.map(a=>e.jsxs(I,{children:[e.jsx(c,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(ye,{className:"h-8 w-8",children:[e.jsx(be,{src:a.avatar_url}),e.jsx(Ce,{children:a.name?a.name.split(" ").map(s=>s[0]).join(""):a.email.charAt(0).toUpperCase()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:a.name||"Nome não informado"}),e.jsx("p",{className:"text-sm text-gray-500",children:a.email})]})]})}),e.jsx(c,{children:e.jsx(_,{className:`${ue(a.plan)} border-0`,children:ve(a.plan)})}),e.jsx(c,{children:e.jsx(_,{className:`${ge(a.status)} border-0`,children:fe(a.status)})}),e.jsx(c,{children:A(a.created_at)}),e.jsx(c,{children:A(a.last_access)}),e.jsxs(c,{children:[e.jsx("span",{className:"font-medium",children:a.total_analyses}),a.plan==="free"&&a.total_analyses>=5&&e.jsx("span",{className:"ml-2 px-1.5 py-0.5 text-xs bg-yellow-100 text-yellow-800 rounded",children:"Potencial"})]}),e.jsx(c,{children:e.jsx("span",{className:a.revenue>0?"font-medium text-green-600":"text-gray-500",children:je(a.revenue)})}),e.jsx(c,{children:e.jsxs(Re,{children:[e.jsx(ke,{asChild:!0,children:e.jsx(w,{variant:"ghost",size:"sm",children:e.jsx(Ie,{className:"w-4 h-4"})})}),e.jsxs(De,{align:"end",children:[e.jsxs(h,{onClick:()=>ce(a.id,a.name||a.email),children:[e.jsx(K,{className:"mr-2 h-4 w-4"}),"Editar"]}),e.jsxs(h,{onClick:()=>oe(a.id,a.email,a.name||a.email),children:[e.jsx(Ve,{className:"mr-2 h-4 w-4"}),"Enviar Email"]}),a.plan!=="enterprise"&&e.jsxs(h,{className:"text-amber-600 focus:text-amber-700 focus:bg-amber-50",onClick:()=>te(a.id,a.name||a.email),children:[e.jsx(v,{className:"mr-2 h-4 w-4"}),"Tornar Admin"]}),a.plan==="free"&&e.jsxs(h,{className:"text-blue-600",onClick:()=>re(a.id,a.name||a.email),children:[e.jsx(N,{className:"mr-2 h-4 w-4"}),"Promover para Pro"]}),e.jsxs(h,{onClick:()=>ne(a.id,a.name||a.email),children:[e.jsx(K,{className:"mr-2 h-4 w-4"}),"Resetar Senha"]}),e.jsx(Ae,{}),a.status==="active"?e.jsxs(h,{className:"text-red-600",onClick:()=>k(a.id,a.name||a.email,a.status),children:[e.jsx(ze,{className:"mr-2 h-4 w-4"}),"Bloquear"]}):e.jsxs(h,{className:"text-green-600",onClick:()=>k(a.id,a.name||a.email,a.status),children:[e.jsx(Ge,{className:"mr-2 h-4 w-4"}),"Ativar"]})]})]})})]},a.id))})]})}),T.length===0&&!F&&e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-500",children:x.length===0?"Nenhum usuário cadastrado":"Nenhum usuário encontrado com os filtros aplicados"})})]})]})]})};export{wa as default};
